<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#0d2818">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="API Mastery">
<meta name="description" content="Professional API Development Mastery Guide">
<title>API Mastery Guide</title>

<style>
/* ============================================
   DESIGN TOKENS
   ============================================ */
:root {
  /* Green Monochromatic Palette */
  --mint:        #e8f5e9;
  --mint-mid:    #c8e6c9;
  --green-light: #81c784;
  --green-mid:   #4caf50;
  --green-deep:  #2e7d32;
  --green-forest:#1b5e20;
  --green-dark:  #0d2818;
  --neon:        #69ff47;
  --neon-dim:    #39d900;

  /* Semantic */
  --bg:          #0a1f12;
  --bg-card:     #0f2a18;
  --bg-elevated: #152f1e;
  --bg-glass:    rgba(21, 47, 30, 0.82);
  --border:      rgba(78, 160, 90, 0.18);
  --border-bright: rgba(105, 255, 71, 0.28);

  /* Text - WCAG AAA */
  --text-primary:   #f0faf1;
  --text-secondary: #a5d6a7;
  --text-muted:     #6a9e6e;
  --text-code:      #69ff47;

  /* Shadows - Apple style */
  --shadow-sm:  0 2px 8px rgba(0,0,0,0.35), 0 1px 3px rgba(0,0,0,0.25);
  --shadow-md:  0 4px 20px rgba(0,0,0,0.45), 0 2px 8px rgba(0,0,0,0.3);
  --shadow-lg:  0 8px 40px rgba(0,0,0,0.55), 0 4px 16px rgba(0,0,0,0.35);
  --shadow-neon: 0 0 20px rgba(105,255,71,0.18), 0 0 60px rgba(105,255,71,0.08);

  /* Modular Scale (1.25 ratio) */
  --text-xs:   0.64rem;   /* ~10px */
  --text-sm:   0.8rem;    /* ~13px */
  --text-base: 1rem;      /* 16px */
  --text-lg:   1.25rem;   /* 20px */
  --text-xl:   1.563rem;  /* 25px */
  --text-2xl:  1.953rem;  /* 31px */
  --text-3xl:  2.441rem;  /* 39px */

  /* Spacing (8px base grid) */
  --sp-1: 8px;
  --sp-2: 16px;
  --sp-3: 24px;
  --sp-4: 32px;
  --sp-5: 40px;
  --sp-6: 48px;
  --sp-8: 64px;

  /* Typography */
  --font-ui:   'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  --font-mono: 'SF Mono', 'Fira Code', 'Cascadia Code', 'Consolas', monospace;

  /* Nav */
  --nav-h: 64px;
  --icon-size: 24px;

  /* Transitions */
  --ease: cubic-bezier(0.25, 0.46, 0.45, 0.94);
  --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* ============================================
   RESET & BASE
   ============================================ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html {
  font-size: 16px;
  -webkit-text-size-adjust: 100%;
  scroll-behavior: smooth;
}

body {
  font-family: var(--font-ui);
  font-size: var(--text-base);
  color: var(--text-primary);
  background: var(--bg);
  min-height: 100vh;
  min-height: 100dvh;
  overflow-x: hidden;
  line-height: 1.6;
}

/* Noise texture overlay */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
}

/* ============================================
   FOCUS & ACCESSIBILITY
   ============================================ */
:focus-visible {
  outline: 2px solid var(--neon);
  outline-offset: 3px;
  border-radius: 4px;
}

/* ============================================
   SCROLLBAR
   ============================================ */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--green-deep); border-radius: 2px; }

/* ============================================
   LAYOUT
   ============================================ */
#app {
  position: relative;
  z-index: 1;
  min-height: 100dvh;
  padding-bottom: calc(var(--nav-h) + env(safe-area-inset-bottom));
}

.screen {
  display: none;
  min-height: calc(100dvh - var(--nav-h));
  padding: var(--sp-3) var(--sp-2) var(--sp-4);
  animation: fadeIn 0.25s var(--ease);
}

.screen.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ============================================
   BOTTOM NAVIGATION
   ============================================ */
.nav-bar {
  position: fixed;
  bottom: 0;
  left: 0; right: 0;
  height: var(--nav-h);
  background: var(--bg-glass);
  backdrop-filter: blur(20px) saturate(180%);
  -webkit-backdrop-filter: blur(20px) saturate(180%);
  border-top: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-around;
  padding-bottom: env(safe-area-inset-bottom);
  z-index: 100;
  box-shadow: 0 -4px 20px rgba(0,0,0,0.4);
}

.nav-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  min-width: 44px;
  min-height: 44px;
  justify-content: center;
  background: none;
  border: none;
  cursor: pointer;
  position: relative;
  padding: var(--sp-1);
  border-radius: 12px;
  transition: all 0.2s var(--ease);
  color: var(--text-muted);
}

.nav-item::before {
  content: '';
  position: absolute;
  top: 0; left: 50%; transform: translateX(-50%);
  width: 0;
  height: 2px;
  background: var(--neon);
  border-radius: 0 0 2px 2px;
  box-shadow: 0 0 8px var(--neon);
  transition: width 0.25s var(--ease);
}

.nav-item .nav-icon-wrap {
  width: 36px; height: 36px;
  display: flex; align-items: center; justify-content: center;
  border-radius: 10px;
  transition: all 0.2s var(--ease);
}

.nav-item svg {
  width: var(--icon-size);
  height: var(--icon-size);
  transition: all 0.2s var(--ease);
}

.nav-item .nav-label {
  font-size: var(--text-xs);
  font-weight: 500;
  letter-spacing: 0.02em;
  transition: color 0.2s;
}

.nav-item.active {
  color: var(--neon);
}

.nav-item.active::before {
  width: 28px;
}

.nav-item.active .nav-icon-wrap {
  background: rgba(105, 255, 71, 0.12);
  box-shadow: 0 0 12px rgba(105, 255, 71, 0.15);
}

.nav-item:hover:not(.active) {
  color: var(--green-light);
}

/* ============================================
   ATOMIC COMPONENTS
   ============================================ */

/* --- Chip --- */
.chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: var(--text-xs);
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  border: 1px solid var(--border);
}
.chip-green { background: rgba(76,175,80,0.15); color: var(--neon); border-color: rgba(105,255,71,0.25); }
.chip-mint  { background: rgba(129,199,132,0.12); color: var(--green-light); }
.chip-dim   { background: rgba(46,125,50,0.15); color: var(--text-muted); }

/* --- Progress Bar --- */
.progress-bar {
  width: 100%;
  height: 6px;
  background: rgba(78,160,90,0.18);
  border-radius: 3px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--green-mid), var(--neon));
  border-radius: 3px;
  transition: width 0.5s var(--ease);
  box-shadow: 0 0 8px rgba(105,255,71,0.4);
}

/* --- Card --- */
.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: var(--sp-3);
  box-shadow: var(--shadow-md);
  transition: all 0.2s var(--ease);
}
.card:hover { border-color: var(--border-bright); box-shadow: var(--shadow-lg); }
.card-elevated {
  background: var(--bg-elevated);
  border-radius: 20px;
}

/* --- Button --- */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  min-height: 44px;
  padding: 10px 20px;
  border-radius: 12px;
  font-family: var(--font-ui);
  font-size: var(--text-sm);
  font-weight: 600;
  letter-spacing: 0.02em;
  cursor: pointer;
  border: none;
  transition: all 0.2s var(--ease);
  position: relative;
  overflow: hidden;
}
.btn::after {
  content: '';
  position: absolute;
  inset: 0;
  background: rgba(255,255,255,0);
  transition: background 0.15s;
}
.btn:hover::after { background: rgba(255,255,255,0.06); }
.btn:active { transform: scale(0.97); }

.btn-primary {
  background: linear-gradient(135deg, var(--green-mid), var(--green-deep));
  color: #fff;
  box-shadow: 0 4px 14px rgba(46,125,50,0.4), var(--shadow-neon);
}
.btn-primary:hover { box-shadow: 0 6px 20px rgba(46,125,50,0.5), var(--shadow-neon); }
.btn-ghost {
  background: rgba(78,160,90,0.1);
  color: var(--green-light);
  border: 1px solid var(--border);
}
.btn-ghost:hover { background: rgba(78,160,90,0.18); border-color: var(--border-bright); }
.btn-neon {
  background: var(--neon);
  color: var(--green-dark);
  box-shadow: 0 4px 20px rgba(105,255,71,0.35);
  font-weight: 700;
}
.btn-neon:hover { box-shadow: 0 6px 30px rgba(105,255,71,0.5); }
.btn-sm { min-height: 36px; padding: 6px 14px; font-size: var(--text-xs); }
.btn-full { width: 100%; }

/* --- Input --- */
.input-wrap {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.input-label {
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--text-secondary);
  letter-spacing: 0.03em;
}
.input {
  background: rgba(21,47,30,0.8);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 10px 14px;
  color: var(--text-primary);
  font-family: var(--font-ui);
  font-size: var(--text-sm);
  min-height: 44px;
  transition: border-color 0.2s, box-shadow 0.2s;
  width: 100%;
}
.input:focus {
  outline: none;
  border-color: var(--neon);
  box-shadow: 0 0 0 3px rgba(105,255,71,0.12);
}

/* Select with custom arrow */
.select-wrap {
  position: relative;
}
.select-wrap::after {
  content: '';
  position: absolute;
  right: 14px;
  top: 50%;
  transform: translateY(-50%);
  width: 0; height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 6px solid var(--text-muted);
  pointer-events: none;
}
select.input {
  appearance: none;
  padding-right: 36px;
  cursor: pointer;
}

/* --- Section Header --- */
.section-header {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
  margin-bottom: var(--sp-3);
}
.section-title {
  font-size: var(--text-xl);
  font-weight: 700;
  color: var(--text-primary);
  letter-spacing: -0.02em;
}
.section-badge {
  font-size: var(--text-xs);
  font-weight: 700;
  color: var(--neon);
  background: rgba(105,255,71,0.1);
  padding: 2px 8px;
  border-radius: 6px;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

/* --- Accordion --- */
.accordion { border-radius: 14px; overflow: hidden; border: 1px solid var(--border); }
.accordion-item { border-bottom: 1px solid var(--border); }
.accordion-item:last-child { border-bottom: none; }

.accordion-header {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--sp-2) var(--sp-3);
  background: var(--bg-card);
  border: none;
  cursor: pointer;
  color: var(--text-primary);
  font-family: var(--font-ui);
  font-size: var(--text-base);
  font-weight: 600;
  min-height: 56px;
  text-align: left;
  gap: var(--sp-2);
  transition: background 0.2s;
}
.accordion-header:hover { background: var(--bg-elevated); }
.accordion-header.open { color: var(--neon); background: rgba(105,255,71,0.05); }

.accordion-icon {
  width: 24px; height: 24px;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
  transition: transform 0.3s var(--ease);
  color: var(--text-muted);
}
.accordion-header.open .accordion-icon { transform: rotate(180deg); color: var(--neon); }

.accordion-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s var(--ease);
}
.accordion-body.open { max-height: 2000px; }
.accordion-content {
  padding: var(--sp-2) var(--sp-3) var(--sp-3);
  background: rgba(13,40,24,0.6);
  color: var(--text-secondary);
  font-size: var(--text-sm);
  line-height: 1.75;
}

/* --- Code Block --- */
.code-block {
  background: rgba(10,20,13,0.95);
  border: 1px solid rgba(105,255,71,0.15);
  border-radius: 10px;
  padding: var(--sp-2);
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  color: var(--text-code);
  overflow-x: auto;
  margin: var(--sp-2) 0;
  position: relative;
  line-height: 1.7;
}
.code-block .comment { color: var(--text-muted); }
.code-block .keyword { color: #82b1ff; }
.code-block .string  { color: #c3e88d; }
.code-block .number  { color: #f78c6c; }

/* --- Tag --- */
.method-tag {
  display: inline-flex;
  align-items: center;
  min-height: 24px;
  padding: 2px 8px;
  border-radius: 6px;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  font-weight: 700;
  letter-spacing: 0.05em;
}
.method-get    { background: rgba(105,255,71,0.15); color: var(--neon); }
.method-post   { background: rgba(130,177,255,0.15); color: #82b1ff; }
.method-put    { background: rgba(255,204,0,0.15); color: #ffd740; }
.method-delete { background: rgba(255,82,82,0.15); color: #ff5252; }
.method-patch  { background: rgba(147,112,219,0.15); color: #b39ddb; }

.status-tag {
  display: inline-flex;
  align-items: center;
  padding: 2px 8px;
  border-radius: 6px;
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  font-weight: 700;
}
.status-2xx { background: rgba(105,255,71,0.15); color: var(--neon); }
.status-3xx { background: rgba(255,204,0,0.15); color: #ffd740; }
.status-4xx { background: rgba(255,152,0,0.15); color: #ffa726; }
.status-5xx { background: rgba(255,82,82,0.15); color: #ff5252; }

/* ============================================
   HOME SCREEN
   ============================================ */
.hero {
  text-align: center;
  padding: var(--sp-5) var(--sp-2) var(--sp-4);
}
.hero-eyebrow {
  font-size: var(--text-xs);
  font-weight: 700;
  color: var(--neon);
  letter-spacing: 0.15em;
  text-transform: uppercase;
  margin-bottom: var(--sp-2);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.hero-eyebrow::before,
.hero-eyebrow::after {
  content: '';
  flex: 1;
  max-width: 40px;
  height: 1px;
  background: var(--neon);
  opacity: 0.4;
}
.hero-title {
  font-size: var(--text-3xl);
  font-weight: 800;
  line-height: 1.1;
  letter-spacing: -0.04em;
  background: linear-gradient(135deg, var(--text-primary) 0%, var(--green-light) 50%, var(--neon) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: var(--sp-2);
}
.hero-sub {
  font-size: var(--text-base);
  color: var(--text-muted);
  max-width: 320px;
  margin: 0 auto var(--sp-4);
  line-height: 1.7;
}

.stats-row {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--sp-2);
  margin-bottom: var(--sp-4);
}
.stat-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: var(--sp-2);
  text-align: center;
  box-shadow: var(--shadow-sm);
}
.stat-number {
  font-size: var(--text-2xl);
  font-weight: 800;
  color: var(--neon);
  font-variant-numeric: tabular-nums;
  line-height: 1;
  letter-spacing: -0.03em;
}
.stat-label {
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-top: 4px;
  letter-spacing: 0.03em;
}

.modules-grid {
  display: flex;
  flex-direction: column;
  gap: var(--sp-2);
  margin-bottom: var(--sp-4);
}

.module-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: var(--sp-2) var(--sp-3);
  display: flex;
  align-items: center;
  gap: var(--sp-2);
  cursor: pointer;
  transition: all 0.2s var(--ease);
  min-height: 72px;
}
.module-card:hover { border-color: var(--border-bright); transform: translateY(-1px); box-shadow: var(--shadow-md); }
.module-card:active { transform: translateY(0); }

.module-icon {
  width: 44px; height: 44px;
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 20px;
  flex-shrink: 0;
  background: rgba(78,160,90,0.15);
  box-shadow: inset 0 1px 0 rgba(105,255,71,0.1);
}

.module-info { flex: 1; min-width: 0; }
.module-name {
  font-size: var(--text-sm);
  font-weight: 700;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.module-meta {
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-top: 2px;
}

.module-progress { flex-shrink: 0; text-align: right; }
.module-pct {
  font-size: var(--text-xs);
  font-weight: 700;
  color: var(--neon);
  font-variant-numeric: tabular-nums;
}
.module-bar {
  width: 60px;
  height: 4px;
  background: rgba(78,160,90,0.18);
  border-radius: 2px;
  margin-top: 4px;
  overflow: hidden;
}
.module-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--green-mid), var(--neon));
  border-radius: 2px;
  box-shadow: 0 0 6px rgba(105,255,71,0.5);
}

/* ============================================
   LEARN SCREEN
   ============================================ */
.tab-row {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  scrollbar-width: none;
  padding-bottom: 2px;
  margin-bottom: var(--sp-3);
}
.tab-row::-webkit-scrollbar { display: none; }

.tab {
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  min-height: 36px;
  padding: 6px 16px;
  border-radius: 20px;
  font-size: var(--text-xs);
  font-weight: 600;
  letter-spacing: 0.03em;
  cursor: pointer;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-muted);
  transition: all 0.2s var(--ease);
  font-family: var(--font-ui);
}
.tab:hover { color: var(--green-light); border-color: rgba(129,199,132,0.3); }
.tab.active {
  background: rgba(105,255,71,0.12);
  border-color: var(--neon);
  color: var(--neon);
  box-shadow: 0 0 12px rgba(105,255,71,0.12);
}

.learn-section { display: none; }
.learn-section.active { display: block; }

/* Content subsection */
.content-block {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: var(--sp-3);
  margin-bottom: var(--sp-2);
}
.content-block h3 {
  font-size: var(--text-lg);
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: var(--sp-1);
  letter-spacing: -0.02em;
}
.content-block p {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  line-height: 1.75;
  margin-bottom: var(--sp-2);
}
.content-block p:last-child { margin-bottom: 0; }

.key-point {
  display: flex;
  gap: 10px;
  align-items: flex-start;
  padding: 10px;
  border-radius: 8px;
  background: rgba(78,160,90,0.08);
  border-left: 3px solid var(--green-mid);
  margin-bottom: 8px;
  font-size: var(--text-sm);
  color: var(--text-secondary);
  line-height: 1.6;
}
.key-point-icon { flex-shrink: 0; color: var(--neon); margin-top: 2px; }

/* Status Code Grid */
.status-grid {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 8px 16px;
  margin: var(--sp-2) 0;
}
.status-grid-code {
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  font-weight: 700;
  padding: 4px 8px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  white-space: nowrap;
}
.status-grid-desc {
  font-size: var(--text-sm);
  color: var(--text-secondary);
  display: flex;
  align-items: center;
}

/* ============================================
   PRACTICE SCREEN
   ============================================ */
.practice-tabs {
  display: flex;
  gap: 8px;
  margin-bottom: var(--sp-3);
}
.p-tab {
  flex: 1;
  min-height: 44px;
  padding: 8px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-muted);
  font-family: var(--font-ui);
  font-size: var(--text-xs);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s var(--ease);
  text-align: center;
}
.p-tab.active { background: rgba(105,255,71,0.1); border-color: var(--neon); color: var(--neon); }
.p-tab:hover:not(.active) { color: var(--green-light); }

.practice-panel { display: none; }
.practice-panel.active { display: block; }

/* REST Builder */
.rest-builder {
  display: flex;
  flex-direction: column;
  gap: var(--sp-2);
}
.url-row {
  display: flex;
  gap: 8px;
  align-items: center;
}
.url-row .select-wrap { flex-shrink: 0; width: 100px; }
.url-row .input { flex: 1; }

.req-output {
  background: rgba(10,20,13,0.95);
  border: 1px solid rgba(105,255,71,0.15);
  border-radius: 12px;
  padding: var(--sp-2);
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  color: var(--text-code);
  min-height: 120px;
  white-space: pre-wrap;
  word-break: break-all;
}

/* GraphQL Builder */
.gql-builder {
  display: flex;
  flex-direction: column;
  gap: var(--sp-2);
}
.gql-editor {
  background: rgba(10,20,13,0.95);
  border: 1px solid rgba(105,255,71,0.15);
  border-radius: 12px;
  padding: var(--sp-2);
  font-family: var(--font-mono);
  font-size: var(--text-sm);
  color: var(--text-code);
  min-height: 140px;
  resize: vertical;
  width: 100%;
  line-height: 1.7;
}
.gql-editor:focus {
  outline: none;
  border-color: var(--neon);
  box-shadow: 0 0 0 3px rgba(105,255,71,0.1);
}

/* OAuth Flow */
.oauth-flow {
  display: flex;
  flex-direction: column;
  gap: var(--sp-1);
}
.flow-step {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
  padding: var(--sp-2) var(--sp-2);
  border-radius: 12px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  transition: all 0.3s var(--ease);
  opacity: 0.5;
}
.flow-step.active-step {
  opacity: 1;
  border-color: var(--neon);
  background: rgba(105,255,71,0.06);
  box-shadow: 0 0 16px rgba(105,255,71,0.1);
}
.flow-step.done-step {
  opacity: 0.8;
  border-color: var(--green-mid);
}
.step-num {
  width: 32px; height: 32px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: var(--text-xs);
  font-weight: 800;
  background: rgba(78,160,90,0.15);
  color: var(--text-muted);
  flex-shrink: 0;
  transition: all 0.3s;
}
.flow-step.active-step .step-num { background: var(--neon); color: var(--green-dark); box-shadow: 0 0 12px rgba(105,255,71,0.4); }
.flow-step.done-step .step-num { background: var(--green-mid); color: #fff; }
.step-info { flex: 1; }
.step-title { font-size: var(--text-sm); font-weight: 600; color: var(--text-primary); }
.step-desc { font-size: var(--text-xs); color: var(--text-muted); margin-top: 2px; }
.flow-connector {
  width: 2px; height: 16px;
  background: var(--border);
  margin-left: 31px;
  transition: background 0.3s;
}

/* Quiz */
.quiz-container { display: flex; flex-direction: column; gap: var(--sp-2); }
.quiz-q {
  font-size: var(--text-base);
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: var(--sp-2);
  line-height: 1.5;
}
.quiz-options { display: flex; flex-direction: column; gap: 8px; }
.quiz-option {
  min-height: 48px;
  padding: 10px 16px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text-secondary);
  font-family: var(--font-ui);
  font-size: var(--text-sm);
  cursor: pointer;
  text-align: left;
  transition: all 0.2s var(--ease);
  display: flex;
  align-items: center;
  gap: 12px;
}
.quiz-option:hover { border-color: rgba(129,199,132,0.4); color: var(--text-primary); }
.quiz-option.correct { border-color: var(--neon); background: rgba(105,255,71,0.1); color: var(--neon); }
.quiz-option.wrong   { border-color: #ff5252; background: rgba(255,82,82,0.1); color: #ff5252; }
.quiz-option-letter {
  width: 28px; height: 28px;
  border-radius: 8px;
  background: rgba(78,160,90,0.15);
  display: flex; align-items: center; justify-content: center;
  font-weight: 700;
  font-size: var(--text-xs);
  flex-shrink: 0;
}
.quiz-feedback {
  padding: var(--sp-2);
  border-radius: 10px;
  font-size: var(--text-sm);
  font-weight: 500;
  margin-top: var(--sp-1);
  display: none;
}
.quiz-feedback.show { display: block; }
.quiz-feedback.good { background: rgba(105,255,71,0.1); color: var(--neon); border: 1px solid rgba(105,255,71,0.25); }
.quiz-feedback.bad  { background: rgba(255,82,82,0.1); color: #ff5252; border: 1px solid rgba(255,82,82,0.25); }

.quiz-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: var(--sp-2);
}
.quiz-counter {
  font-size: var(--text-xs);
  color: var(--text-muted);
  font-variant-numeric: tabular-nums;
}

/* ============================================
   LOGS SCREEN
   ============================================ */
.log-header {
  display: grid;
  grid-template-columns: 80px 60px 56px 64px 1fr;
  gap: 8px;
  padding: 8px var(--sp-2);
  font-size: var(--text-xs);
  font-weight: 700;
  color: var(--text-muted);
  letter-spacing: 0.06em;
  text-transform: uppercase;
  border-bottom: 1px solid var(--border);
  margin-bottom: 4px;
}
.log-row {
  display: grid;
  grid-template-columns: 80px 60px 56px 64px 1fr;
  gap: 8px;
  padding: 10px var(--sp-2);
  border-radius: 10px;
  border: 1px solid transparent;
  transition: all 0.15s;
  align-items: center;
  cursor: pointer;
}
.log-row:hover { background: var(--bg-card); border-color: var(--border); }
.log-cell {
  font-family: var(--font-mono);
  font-size: var(--text-xs);
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.log-id    { color: var(--text-muted); }
.log-endpoint { color: var(--text-secondary); font-size: 0.7rem; }
.log-latency { color: var(--text-secondary); text-align: right; }

.log-filters {
  display: flex;
  gap: 8px;
  margin-bottom: var(--sp-2);
  overflow-x: auto;
  scrollbar-width: none;
}
.log-filters::-webkit-scrollbar { display: none; }
.log-filter {
  flex-shrink: 0;
  min-height: 36px;
  padding: 6px 14px;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-muted);
  font-family: var(--font-ui);
  font-size: var(--text-xs);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}
.log-filter.active { background: rgba(105,255,71,0.1); border-color: var(--neon); color: var(--neon); }

/* ============================================
   PROFILE SCREEN
   ============================================ */
.profile-header {
  display: flex;
  align-items: center;
  gap: var(--sp-2);
  margin-bottom: var(--sp-4);
  padding: var(--sp-3);
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 20px;
  box-shadow: var(--shadow-md);
}
.avatar {
  width: 64px; height: 64px;
  border-radius: 20px;
  background: linear-gradient(135deg, var(--green-deep), var(--neon));
  display: flex; align-items: center; justify-content: center;
  font-size: 28px;
  flex-shrink: 0;
  box-shadow: 0 4px 16px rgba(105,255,71,0.25);
}
.profile-name {
  font-size: var(--text-lg);
  font-weight: 800;
  color: var(--text-primary);
  letter-spacing: -0.02em;
}
.profile-level {
  font-size: var(--text-xs);
  color: var(--neon);
  font-weight: 600;
  letter-spacing: 0.05em;
  text-transform: uppercase;
}

.achievement-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--sp-2);
  margin-bottom: var(--sp-4);
}
.achievement {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: var(--sp-2);
  text-align: center;
  transition: all 0.2s;
}
.achievement.earned { border-color: rgba(105,255,71,0.3); background: rgba(105,255,71,0.06); }
.achievement-icon { font-size: 28px; margin-bottom: 6px; }
.achievement-name { font-size: var(--text-xs); color: var(--text-muted); font-weight: 600; }
.achievement.earned .achievement-name { color: var(--neon); }

.settings-list {
  display: flex;
  flex-direction: column;
  gap: 2px;
}
.settings-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px var(--sp-2);
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.15s;
  min-height: 44px;
}
.settings-item:hover { background: var(--bg-card); }
.settings-item-label { font-size: var(--text-sm); color: var(--text-secondary); font-weight: 500; }
.settings-item-value { font-size: var(--text-xs); color: var(--text-muted); }
.settings-arrow { color: var(--text-muted); }

/* ============================================
   RESPONSIVE
   ============================================ */
@media (min-width: 640px) {
  .screen { max-width: 560px; margin: 0 auto; }
  .nav-bar { max-width: 560px; left: 50%; transform: translateX(-50%); border-radius: 20px 20px 0 0; }
}

/* ============================================
   ANIMATIONS
   ============================================ */
@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
.animate-pulse { animation: pulse 2s infinite; }

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

.slide-up { animation: slideUp 0.4s var(--ease-spring) both; }

.stagger-1 { animation-delay: 0.05s; }
.stagger-2 { animation-delay: 0.1s; }
.stagger-3 { animation-delay: 0.15s; }
.stagger-4 { animation-delay: 0.2s; }
.stagger-5 { animation-delay: 0.25s; }
.stagger-6 { animation-delay: 0.3s; }
.stagger-7 { animation-delay: 0.35s; }
.stagger-8 { animation-delay: 0.4s; }

/* Divider */
.divider {
  height: 1px;
  background: var(--border);
  margin: var(--sp-3) 0;
}

/* Toast */
.toast {
  position: fixed;
  bottom: calc(var(--nav-h) + 16px);
  left: 50%; transform: translateX(-50%) translateY(20px);
  background: var(--bg-elevated);
  border: 1px solid var(--border-bright);
  border-radius: 12px;
  padding: 12px 20px;
  font-size: var(--text-sm);
  color: var(--text-primary);
  font-weight: 500;
  z-index: 200;
  box-shadow: var(--shadow-lg);
  opacity: 0;
  transition: all 0.3s var(--ease);
  pointer-events: none;
  white-space: nowrap;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* Install banner */
.install-banner {
  display: none;
  margin-bottom: var(--sp-2);
  padding: var(--sp-2);
  background: rgba(105,255,71,0.08);
  border: 1px solid rgba(105,255,71,0.25);
  border-radius: 14px;
  align-items: center;
  gap: var(--sp-2);
}
.install-banner.show { display: flex; }
.install-banner-text { flex: 1; font-size: var(--text-xs); color: var(--text-secondary); }
</style>
</head>
<body>

<div id="app">
  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- INSTALL BANNER -->
  <div class="install-banner" id="installBanner">
    <span style="font-size:20px">üì≤</span>
    <span class="install-banner-text">Install <strong>API Mastery</strong> for offline access</span>
    <button class="btn btn-neon btn-sm" id="installBtn">Install</button>
  </div>

  <!-- ==================== HOME ==================== -->
  <div class="screen active" id="screen-home">
    <div class="hero">
      <div class="hero-eyebrow">Professional Curriculum</div>
      <h1 class="hero-title">API Mastery<br>Guide</h1>
      <p class="hero-sub">From HTTP fundamentals to production-grade distributed systems engineering.</p>
      <button class="btn btn-neon" onclick="navigate('learn')" style="margin:0 auto;">Start Learning ‚Üí</button>
    </div>

    <div class="stats-row slide-up stagger-1">
      <div class="stat-card">
        <div class="stat-number" id="stat-modules">8</div>
        <div class="stat-label">Modules</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-lessons">48</div>
        <div class="stat-label">Lessons</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="stat-score">0%</div>
        <div class="stat-label">Progress</div>
      </div>
    </div>

    <div class="section-header slide-up stagger-2">
      <h2 class="section-title">Curriculum</h2>
      <span class="section-badge">8 Tracks</span>
    </div>

    <div class="modules-grid">
      <div class="module-card slide-up stagger-1" onclick="navigate('learn',0)">
        <div class="module-icon">üåê</div>
        <div class="module-info">
          <div class="module-name">Foundations</div>
          <div class="module-meta">HTTP ¬∑ JSON ¬∑ Client-Server</div>
        </div>
        <div class="module-progress">
          <div class="module-pct" id="mp-0">0%</div>
          <div class="module-bar"><div class="module-bar-fill" id="mb-0" style="width:0%"></div></div>
        </div>
      </div>
      <div class="module-card slide-up stagger-2" onclick="navigate('learn',1)">
        <div class="module-icon">üîó</div>
        <div class="module-info">
          <div class="module-name">REST Deep Dive</div>
          <div class="module-meta">Methods ¬∑ Status ¬∑ Versioning</div>
        </div>
        <div class="module-progress">
          <div class="module-pct" id="mp-1">0%</div>
          <div class="module-bar"><div class="module-bar-fill" id="mb-1" style="width:0%"></div></div>
        </div>
      </div>
      <div class="module-card slide-up stagger-3" onclick="navigate('learn',2)">
        <div class="module-icon">‚ö°</div>
        <div class="module-info">
          <div class="module-name">GraphQL Mastery</div>
          <div class="module-meta">Schema ¬∑ Resolvers ¬∑ N+1</div>
        </div>
        <div class="module-progress">
          <div class="module-pct" id="mp-2">0%</div>
          <div class="module-bar"><div class="module-bar-fill" id="mb-2" style="width:0%"></div></div>
        </div>
      </div>
      <div class="module-card slide-up stagger-4" onclick="navigate('learn',3)">
        <div class="module-icon">üîî</div>
        <div class="module-info">
          <div class="module-name">Webhooks</div>
          <div class="module-meta">Events ¬∑ Signatures ¬∑ Retry</div>
        </div>
        <div class="module-progress">
          <div class="module-pct" id="mp-3">0%</div>
          <div class="module-bar"><div class="module-bar-fill" id="mb-3" style="width:0%"></div></div>
        </div>
      </div>
      <div class="module-card slide-up stagger-5" onclick="navigate('learn',4)">
        <div class="module-icon">üîê</div>
        <div class="module-info">
          <div class="module-name">OAuth2 & AuthN</div>
          <div class="module-meta">PKCE ¬∑ JWT ¬∑ Token Rotation</div>
        </div>
        <div class="module-progress">
          <div class="module-pct" id="mp-4">0%</div>
          <div class="module-bar"><div class="module-bar-fill" id="mb-4" style="width:0%"></div></div>
        </div>
      </div>
      <div class="module-card slide-up stagger-6" onclick="navigate('learn',5)">
        <div class="module-icon">üõ°Ô∏è</div>
        <div class="module-info">
          <div class="module-name">Security Engineering</div>
          <div class="module-meta">Rate Limiting ¬∑ CORS ¬∑ HMAC</div>
        </div>
        <div class="module-progress">
          <div class="module-pct" id="mp-5">0%</div>
          <div class="module-bar"><div class="module-bar-fill" id="mb-5" style="width:0%"></div></div>
        </div>
      </div>
      <div class="module-card slide-up stagger-7" onclick="navigate('learn',6)">
        <div class="module-icon">üìä</div>
        <div class="module-info">
          <div class="module-name">Production Engineering</div>
          <div class="module-meta">Observability ¬∑ OpenAPI ¬∑ Docs</div>
        </div>
        <div class="module-progress">
          <div class="module-pct" id="mp-6">0%</div>
          <div class="module-bar"><div class="module-bar-fill" id="mb-6" style="width:0%"></div></div>
        </div>
      </div>
      <div class="module-card slide-up stagger-8" onclick="navigate('learn',7)">
        <div class="module-icon">üèóÔ∏è</div>
        <div class="module-info">
          <div class="module-name">System Design</div>
          <div class="module-meta">Microservices ¬∑ Scaling ¬∑ Public APIs</div>
        </div>
        <div class="module-progress">
          <div class="module-pct" id="mp-7">0%</div>
          <div class="module-bar"><div class="module-bar-fill" id="mb-7" style="width:0%"></div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== LEARN ==================== -->
  <div class="screen" id="screen-learn">
    <div class="section-header">
      <h2 class="section-title">Learn</h2>
    </div>

    <div class="tab-row" id="learnTabs">
      <button class="tab active" onclick="switchLearnTab(0)">Foundations</button>
      <button class="tab" onclick="switchLearnTab(1)">REST</button>
      <button class="tab" onclick="switchLearnTab(2)">GraphQL</button>
      <button class="tab" onclick="switchLearnTab(3)">Webhooks</button>
      <button class="tab" onclick="switchLearnTab(4)">OAuth2</button>
      <button class="tab" onclick="switchLearnTab(5)">Security</button>
      <button class="tab" onclick="switchLearnTab(6)">Production</button>
      <button class="tab" onclick="switchLearnTab(7)">System Design</button>
    </div>

    <!-- MODULE 0: FOUNDATIONS -->
    <div class="learn-section active" id="ls-0">
      <div class="content-block">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <h3>What is an API?</h3>
          <span class="chip chip-green">Core</span>
        </div>
        <p>An <strong style="color:var(--neon)">Application Programming Interface</strong> is a contract between software components. It defines how a client can request operations from a server, what data formats are expected, and what responses will be returned. Think of it as a waiter in a restaurant ‚Äî you don't need to know how the kitchen works, you just use the menu (the API).</p>
        <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>APIs decouple consumers from implementation. The frontend doesn't care if the backend is Node.js or Go ‚Äî it just cares about the contract.</span></div>
        <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Good APIs are stable, versioned, and documented. Breaking changes require version bumps ‚Äî never mutate existing endpoints.</span></div>
      </div>

      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Client-Server Architecture</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>The <strong>client</strong> is any process that initiates a request. The <strong>server</strong> is a process that listens, processes, and responds. They communicate over a protocol ‚Äî HTTP/HTTPS in web APIs.</p>
              <p><strong>Request-Response cycle:</strong> Client sends HTTP request ‚Üí Server routes to handler ‚Üí Handler processes business logic ‚Üí Server serializes response ‚Üí Client deserializes and uses data.</p>
              <div class="code-block"><span class="comment"># HTTP Request anatomy</span>
<span class="keyword">POST</span> <span class="string">/api/v1/users</span> HTTP/1.1
Host: api.example.com
Content-Type: application/json
Authorization: Bearer eyJhbGc...

{
  <span class="string">"email"</span>: <span class="string">"dev@example.com"</span>,
  <span class="string">"role"</span>: <span class="string">"admin"</span>
}</div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Statelessness: Each request must contain all information needed to fulfill it. No server-side session state.</span></div>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>HTTP Fundamentals</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>HTTP (Hypertext Transfer Protocol) is the foundation of web communication. Understanding it deeply is critical for API mastery.</p>
              <p><strong>Key headers you must know:</strong></p>
              <div class="code-block"><span class="comment"># Request Headers</span>
Content-Type: application/json    <span class="comment"># body format</span>
Accept: application/json          <span class="comment"># expected response</span>
Authorization: Bearer {token}     <span class="comment"># auth credential</span>
X-Request-ID: uuid-v4            <span class="comment"># tracing</span>
Idempotency-Key: uuid-v4         <span class="comment"># safe retries</span>
If-None-Match: "etag-value"      <span class="comment"># conditional</span>

<span class="comment"># Response Headers</span>
Cache-Control: max-age=3600       <span class="comment"># caching</span>
ETag: "abc123"                    <span class="comment"># resource version</span>
Retry-After: 60                  <span class="comment"># rate limit reset</span>
X-RateLimit-Remaining: 45        <span class="comment"># quota info</span></div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>HTTP/2 multiplexes requests over a single TCP connection, eliminating head-of-line blocking. HTTP/3 uses QUIC (UDP-based) for even lower latency.</span></div>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>JSON & Data Formats</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>JSON is the lingua franca of APIs but it has tradeoffs. For high-performance systems, consider alternatives.</p>
              <div class="code-block"><span class="comment"># JSON ‚Äî Human readable, universally supported</span>
{
  <span class="string">"id"</span>: <span class="number">12345</span>,
  <span class="string">"created_at"</span>: <span class="string">"2024-01-15T10:30:00Z"</span>,
  <span class="string">"tags"</span>: [<span class="string">"api"</span>, <span class="string">"rest"</span>],
  <span class="string">"metadata"</span>: { <span class="string">"region"</span>: <span class="string">"us-east-1"</span> }
}

<span class="comment"># Protobuf ‚Äî Binary, typed, 3-10x smaller</span>
message User {
  int64 id = 1;
  string email = 2;
  repeated string tags = 3;
}</div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Always use ISO 8601 for dates. Never send bare Unix timestamps without documentation. Include timezone (Z or offset).</span></div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Validate and sanitize all inbound JSON. JSON parsing errors are a common attack vector ‚Äî return 400, not 500.</span></div>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top:var(--sp-3)">
        <button class="btn btn-primary btn-full" onclick="markComplete(0)">Mark Module Complete ‚úì</button>
      </div>
    </div>

    <!-- MODULE 1: REST -->
    <div class="learn-section" id="ls-1">
      <div class="content-block">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <h3>Resource Design</h3>
          <span class="chip chip-green">REST</span>
        </div>
        <p>REST (Representational State Transfer) uses HTTP semantics to expose resources. Resources are <em>nouns</em>, HTTP methods are <em>verbs</em>. Your URL design is part of your public API contract ‚Äî treat it seriously.</p>
        <div class="code-block"><span class="comment"># ‚úÖ Good resource design</span>
GET    /users                <span class="comment"># list users</span>
POST   /users                <span class="comment"># create user</span>
GET    /users/{id}           <span class="comment"># get user</span>
PUT    /users/{id}           <span class="comment"># replace user</span>
PATCH  /users/{id}           <span class="comment"># partial update</span>
DELETE /users/{id}           <span class="comment"># delete user</span>
GET    /users/{id}/posts     <span class="comment"># nested resource</span>

<span class="comment"># ‚ùå Bad patterns</span>
POST   /createUser           <span class="comment"># verb in URL</span>
GET    /getUser?action=delete <span class="comment"># action as param</span>
POST   /users/delete/{id}    <span class="comment"># method in path</span></div>
      </div>

      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>HTTP Methods & Idempotency</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>Idempotency means calling an operation N times produces the same result as calling it once. This is critical for safe retries.</p>
              <div style="display:flex;flex-direction:column;gap:8px;margin:var(--sp-2) 0">
                <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:8px;border:1px solid var(--border)">
                  <span class="method-tag method-get">GET</span>
                  <span style="font-size:var(--text-xs);color:var(--text-secondary)">Safe + Idempotent. Read-only. Cacheable.</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:8px;border:1px solid var(--border)">
                  <span class="method-tag method-post">POST</span>
                  <span style="font-size:var(--text-xs);color:var(--text-secondary)">Not safe, not idempotent. Creates resources. Use Idempotency-Key header for retries.</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:8px;border:1px solid var(--border)">
                  <span class="method-tag method-put">PUT</span>
                  <span style="font-size:var(--text-xs);color:var(--text-secondary)">Idempotent. Full replacement. If resource doesn't exist, create it.</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:8px;border:1px solid var(--border)">
                  <span class="method-tag method-patch">PATCH</span>
                  <span style="font-size:var(--text-xs);color:var(--text-secondary)">Partial update. Use JSON Patch (RFC 6902) for precise mutations.</span>
                </div>
                <div style="display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg);border-radius:8px;border:1px solid var(--border)">
                  <span class="method-tag method-delete">DELETE</span>
                  <span style="font-size:var(--text-xs);color:var(--text-secondary)">Idempotent. Deleting a non-existent resource should return 404 or 204.</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Status Codes Mastery</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="status-grid">
                <div><span class="status-tag status-2xx">200</span></div><div class="status-grid-desc">OK ‚Äî Successful GET, PUT, PATCH</div>
                <div><span class="status-tag status-2xx">201</span></div><div class="status-grid-desc">Created ‚Äî Successful POST, include Location header</div>
                <div><span class="status-tag status-2xx">204</span></div><div class="status-grid-desc">No Content ‚Äî Successful DELETE, no body</div>
                <div><span class="status-tag status-2xx">206</span></div><div class="status-grid-desc">Partial Content ‚Äî Paginated or range responses</div>
                <div><span class="status-tag status-3xx">301</span></div><div class="status-grid-desc">Moved Permanently ‚Äî API version deprecation</div>
                <div><span class="status-tag status-3xx">304</span></div><div class="status-grid-desc">Not Modified ‚Äî ETag/If-None-Match match</div>
                <div><span class="status-tag status-4xx">400</span></div><div class="status-grid-desc">Bad Request ‚Äî Validation error, malformed JSON</div>
                <div><span class="status-tag status-4xx">401</span></div><div class="status-grid-desc">Unauthorized ‚Äî No/invalid credentials</div>
                <div><span class="status-tag status-4xx">403</span></div><div class="status-grid-desc">Forbidden ‚Äî Valid auth, insufficient permissions</div>
                <div><span class="status-tag status-4xx">404</span></div><div class="status-grid-desc">Not Found ‚Äî Resource doesn't exist</div>
                <div><span class="status-tag status-4xx">409</span></div><div class="status-grid-desc">Conflict ‚Äî Duplicate resource, optimistic locking</div>
                <div><span class="status-tag status-4xx">422</span></div><div class="status-grid-desc">Unprocessable Entity ‚Äî Semantic validation failure</div>
                <div><span class="status-tag status-4xx">429</span></div><div class="status-grid-desc">Too Many Requests ‚Äî Rate limited, check Retry-After</div>
                <div><span class="status-tag status-5xx">500</span></div><div class="status-grid-desc">Internal Server Error ‚Äî Never leak stack traces</div>
                <div><span class="status-tag status-5xx">503</span></div><div class="status-grid-desc">Service Unavailable ‚Äî Maintenance, circuit breaker open</div>
              </div>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Pagination & Filtering</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>Never return unbounded collections. Always paginate. Choose the right strategy for your use case.</p>
              <div class="code-block"><span class="comment"># Offset pagination ‚Äî simple but has drift issues</span>
GET /posts?limit=20&offset=40

<span class="comment"># Cursor pagination ‚Äî stable, efficient for large datasets</span>
GET /posts?limit=20&after=cursor_abc123

<span class="comment"># Response envelope with pagination metadata</span>
{
  <span class="string">"data"</span>: [...],
  <span class="string">"pagination"</span>: {
    <span class="string">"next_cursor"</span>: <span class="string">"cursor_xyz"</span>,
    <span class="string">"has_more"</span>: <span class="keyword">true</span>,
    <span class="string">"total"</span>: <span class="number">1247</span>
  }
}

<span class="comment"># Filtering ‚Äî use query params</span>
GET /users?status=active&role=admin&created_after=2024-01-01</div>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Error Handling Architecture</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>Consistent error responses are non-negotiable in production APIs. Adopt a standard error schema (RFC 7807 Problem Details is excellent).</p>
              <div class="code-block"><span class="comment"># RFC 7807 Problem Details</span>
Content-Type: application/problem+json

{
  <span class="string">"type"</span>: <span class="string">"https://api.example.com/errors/validation"</span>,
  <span class="string">"title"</span>: <span class="string">"Validation Error"</span>,
  <span class="string">"status"</span>: <span class="number">422</span>,
  <span class="string">"detail"</span>: <span class="string">"The request body contains invalid fields"</span>,
  <span class="string">"instance"</span>: <span class="string">"/api/v1/users/create"</span>,
  <span class="string">"errors"</span>: [
    { <span class="string">"field"</span>: <span class="string">"email"</span>, <span class="string">"code"</span>: <span class="string">"INVALID_FORMAT"</span> },
    { <span class="string">"field"</span>: <span class="string">"age"</span>, <span class="string">"code"</span>: <span class="string">"MUST_BE_POSITIVE"</span> }
  ]
}</div>
            </div>
          </div>
        </div>
      </div>
      <div style="margin-top:var(--sp-3)">
        <button class="btn btn-primary btn-full" onclick="markComplete(1)">Mark Module Complete ‚úì</button>
      </div>
    </div>

    <!-- MODULE 2: GRAPHQL -->
    <div class="learn-section" id="ls-2">
      <div class="content-block">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <h3>GraphQL Fundamentals</h3>
          <span class="chip chip-green">GraphQL</span>
        </div>
        <p>GraphQL is a query language for APIs and a runtime for executing those queries. Unlike REST, the client specifies exactly what data it needs. This eliminates over-fetching and under-fetching ‚Äî two of REST's most painful problems.</p>
        <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Single endpoint (/graphql), client-defined data shape, strongly typed schema, introspectable API.</span></div>
        <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>GraphQL always returns 200 OK ‚Äî errors are embedded in the response body alongside partial data.</span></div>
      </div>
      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Schema Design Principles</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="code-block"><span class="comment"># GraphQL Schema Definition Language (SDL)</span>
<span class="keyword">type</span> User {
  id: ID!
  email: String!
  posts(limit: Int = 10): [Post!]!
  createdAt: DateTime!
}

<span class="keyword">type</span> Post {
  id: ID!
  title: String!
  author: User!         <span class="comment"># nested relationship</span>
  tags: [String!]!
}

<span class="keyword">type</span> Query {
  user(id: ID!): User
  users(filter: UserFilter): [User!]!
  me: User              <span class="comment"># requires auth context</span>
}

<span class="keyword">type</span> Mutation {
  createPost(input: CreatePostInput!): Post!
  deletePost(id: ID!): Boolean!
}

<span class="keyword">type</span> Subscription {
  postCreated: Post!    <span class="comment"># real-time via WebSocket</span>
}</div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Use Input types for mutations. Use ! (non-null) deliberately. Avoid deeply nested types ‚Äî keep the schema flat where possible.</span></div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>The N+1 Problem & DataLoader</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>The N+1 problem occurs when fetching a list of items then making a separate query for each item's related data. This is the #1 performance killer in GraphQL.</p>
              <div class="code-block"><span class="comment"># ‚ùå N+1: 1 query for posts + N queries for authors</span>
posts ‚Üí [post1, post2, post3...]
  post1.author ‚Üí DB query
  post2.author ‚Üí DB query  <span class="comment"># separate query!</span>
  post3.author ‚Üí DB query  <span class="comment"># separate query!</span>

<span class="comment"># ‚úÖ DataLoader solution: batch + cache</span>
<span class="keyword">const</span> userLoader = <span class="keyword">new</span> DataLoader(<span class="keyword">async</span> (userIds) => {
  <span class="comment">// ONE query for all user IDs</span>
  <span class="keyword">const</span> users = <span class="keyword">await</span> db.users.findMany({
    where: { id: { in: userIds } }
  });
  <span class="keyword">return</span> userIds.map(id => users.find(u => u.id === id));
});</div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Authentication in GraphQL</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>Authentication happens at the HTTP layer (middleware), authorization happens in resolvers or a dedicated service.</p>
              <div class="code-block"><span class="comment"># Pattern: Auth in context</span>
<span class="keyword">const</span> server = <span class="keyword">new</span> ApolloServer({
  typeDefs, resolvers,
  context: ({ req }) => {
    <span class="keyword">const</span> token = req.headers.authorization?.split(' ')[1];
    <span class="keyword">const</span> user = verifyJWT(token); <span class="comment">// throws if invalid</span>
    <span class="keyword">return</span> { user, loaders: createLoaders() };
  }
});

<span class="comment"># Resolver-level authorization</span>
Query: {
  adminDashboard: (_, __, { user }) => {
    <span class="keyword">if</span> (!user || user.role !== <span class="string">'admin'</span>)
      <span class="keyword">throw new</span> ForbiddenError(<span class="string">'Admin only'</span>);
    <span class="keyword">return</span> getDashboardData();
  }
}</div>
            </div>
          </div>
        </div>
      </div>
      <div style="margin-top:var(--sp-3)">
        <button class="btn btn-primary btn-full" onclick="markComplete(2)">Mark Module Complete ‚úì</button>
      </div>
    </div>

    <!-- MODULE 3: WEBHOOKS -->
    <div class="learn-section" id="ls-3">
      <div class="content-block">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <h3>Webhooks Architecture</h3>
          <span class="chip chip-green">Events</span>
        </div>
        <p>Webhooks are HTTP callbacks ‚Äî your server pushes events to consumers when something happens. This inverts the polling model: instead of consumers asking "any updates?", you tell them "here's what happened."</p>
        <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Webhooks are fire-and-forget by default. Your delivery system must handle failures gracefully with exponential backoff.</span></div>
      </div>
      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Signature Verification (HMAC)</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>Every webhook you send should be signed. Consumers verify the signature to confirm the payload hasn't been tampered with and came from you.</p>
              <div class="code-block"><span class="comment"># Sender: Sign the payload</span>
<span class="keyword">const</span> signature = crypto
  .createHmac(<span class="string">'sha256'</span>, WEBHOOK_SECRET)
  .update(rawBody)
  .digest(<span class="string">'hex'</span>);

<span class="comment"># Header format</span>
X-Webhook-Signature: sha256=abc123...
X-Webhook-Timestamp: 1705312200

<span class="comment"># Receiver: Verify</span>
<span class="keyword">const</span> expected = crypto
  .createHmac(<span class="string">'sha256'</span>, secret)
  .update(rawBody)
  .digest(<span class="string">'hex'</span>);

<span class="comment"># Use timing-safe comparison!</span>
<span class="keyword">if</span> (!crypto.timingSafeEqual(
  Buffer.from(received),
  Buffer.from(expected)
)) throw <span class="keyword">new</span> Error(<span class="string">'Invalid signature'</span>);</div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Idempotency & Replay Protection</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>Networks are unreliable. Your webhook sender will retry on failure. Your receiver must be idempotent ‚Äî processing the same event twice must have the same effect as once.</p>
              <div class="code-block"><span class="comment"># Every event needs a unique ID</span>
{
  <span class="string">"id"</span>: <span class="string">"evt_01HABCDEF123"</span>,    <span class="comment"># unique event ID</span>
  <span class="string">"type"</span>: <span class="string">"payment.completed"</span>,
  <span class="string">"timestamp"</span>: <span class="string">"2024-01-15T10:30:00Z"</span>,
  <span class="string">"data"</span>: { ... }
}

<span class="comment"># Receiver: deduplication</span>
<span class="keyword">async function</span> handleWebhook(event) {
  <span class="keyword">const</span> processed = <span class="keyword">await</span> redis.get(`evt:${event.id}`);
  <span class="keyword">if</span> (processed) <span class="keyword">return</span> { status: <span class="string">'already_processed'</span> };
  
  <span class="keyword">await</span> processEvent(event);
  <span class="keyword">await</span> redis.setex(`evt:${event.id}`, 86400, <span class="string">'1'</span>);
}

<span class="comment"># Replay attack prevention: reject old timestamps</span>
<span class="keyword">const</span> age = Date.now() - new Date(event.timestamp).getTime();
<span class="keyword">if</span> (age > 5 * 60 * 1000) throw <span class="keyword">new</span> Error(<span class="string">'Stale event'</span>);</div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Retry Strategies</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="code-block"><span class="comment"># Exponential backoff with jitter</span>
attempt 1: immediate
attempt 2: 1s  + jitter
attempt 3: 2s  + jitter
attempt 4: 4s  + jitter
attempt 5: 8s  + jitter
attempt 6: 16s + jitter
max 24h dead letter queue

<span class="comment"># Retry on: 5xx, timeout, connection refused</span>
<span class="comment"># Don't retry on: 4xx (except 429), 2xx</span>
<span class="comment"># 429: respect Retry-After header</span></div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Alert consumers when a webhook endpoint goes down. Dead-letter queues allow manual replay after the consumer fixes their endpoint.</span></div>
            </div>
          </div>
        </div>
      </div>
      <div style="margin-top:var(--sp-3)">
        <button class="btn btn-primary btn-full" onclick="markComplete(3)">Mark Module Complete ‚úì</button>
      </div>
    </div>

    <!-- MODULE 4: OAUTH2 -->
    <div class="learn-section" id="ls-4">
      <div class="content-block">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <h3>OAuth 2.0 Framework</h3>
          <span class="chip chip-green">Auth</span>
        </div>
        <p>OAuth 2.0 is an authorization framework, not an authentication protocol. It enables third-party apps to obtain limited access to user resources without exposing credentials. OpenID Connect (OIDC) extends OAuth 2.0 for authentication.</p>
        <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Four roles: Resource Owner (user), Client (app), Authorization Server (IdP), Resource Server (API).</span></div>
      </div>
      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>OAuth 2.0 Flows</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p><strong>Authorization Code + PKCE</strong> ‚Äî For public clients (SPAs, mobile). PKCE prevents authorization code interception attacks.</p>
              <div class="code-block"><span class="comment"># PKCE flow</span>
<span class="number">1.</span> Generate code_verifier (random 43-128 chars)
<span class="number">2.</span> code_challenge = BASE64URL(SHA256(code_verifier))
<span class="number">3.</span> Redirect to: /authorize?
     client_id=abc
     &redirect_uri=https://app.com/callback
     &response_type=code
     &scope=openid profile
     &code_challenge=xyz
     &code_challenge_method=S256
<span class="number">4.</span> Exchange code + code_verifier for tokens
     POST /token
     { grant_type: authorization_code,
       code: AUTH_CODE,
       code_verifier: VERIFIER }</div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Client Credentials flow: machine-to-machine. No user. POST /token with client_id + client_secret. Used for service-to-service APIs.</span></div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>JWT Structure & Validation</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="code-block"><span class="comment"># JWT = Header.Payload.Signature</span>

<span class="comment"># Header (Base64URL)</span>
{ <span class="string">"alg"</span>: <span class="string">"RS256"</span>, <span class="string">"typ"</span>: <span class="string">"JWT"</span> }

<span class="comment"># Payload (Base64URL)</span>
{
  <span class="string">"sub"</span>: <span class="string">"user_123"</span>,         <span class="comment"># subject</span>
  <span class="string">"iss"</span>: <span class="string">"https://auth.example.com"</span>,
  <span class="string">"aud"</span>: <span class="string">"api.example.com"</span>,  <span class="comment"># audience</span>
  <span class="string">"exp"</span>: <span class="number">1705315800</span>,        <span class="comment"># expiry Unix time</span>
  <span class="string">"iat"</span>: <span class="number">1705312200</span>,        <span class="comment"># issued at</span>
  <span class="string">"scope"</span>: <span class="string">"read:users write:posts"</span>
}

<span class="comment"># Validation checklist:</span>
<span class="comment"># ‚úì Verify signature (use public key from JWKS)</span>
<span class="comment"># ‚úì Check exp (not expired)</span>
<span class="comment"># ‚úì Check iss (trusted issuer)</span>
<span class="comment"># ‚úì Check aud (matches your API)</span>
<span class="comment"># ‚úì Check scope (has required permission)</span>
<span class="comment"># ‚úì Never use alg: none ‚Äî reject it</span></div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Token Security & Storage</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>Access tokens are short-lived (15min‚Äì1hr). Refresh tokens are long-lived and must be stored securely.</p>
              <div class="code-block"><span class="comment"># Storage strategies</span>

<span class="comment"># SPAs (Browser)</span>
Access token:   in-memory (JS variable)
Refresh token:  httpOnly, Secure, SameSite=Strict cookie
<span class="comment"># httpOnly prevents XSS from reading the token</span>

<span class="comment"># Mobile Apps</span>
Access token:   in-memory or secure keystore
Refresh token:  Keychain (iOS) / Keystore (Android)
<span class="comment"># Never store in AsyncStorage/SharedPreferences</span>

<span class="comment"># Token Rotation</span>
<span class="comment"># Each refresh call issues a NEW refresh token</span>
<span class="comment"># Old refresh token is immediately invalidated</span>
<span class="comment"># Detect token reuse ‚Üí revoke entire family</span></div>
            </div>
          </div>
        </div>
      </div>
      <div style="margin-top:var(--sp-3)">
        <button class="btn btn-primary btn-full" onclick="markComplete(4)">Mark Module Complete ‚úì</button>
      </div>
    </div>

    <!-- MODULE 5: SECURITY -->
    <div class="learn-section" id="ls-5">
      <div class="content-block">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <h3>API Security Engineering</h3>
          <span class="chip chip-green">Security</span>
        </div>
        <p>Security is not a feature you add later ‚Äî it's a property of every design decision. APIs are public attack surfaces. Zero trust means verify every request, every time, regardless of origin.</p>
      </div>
      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Rate Limiting Strategies</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="code-block"><span class="comment"># Fixed Window ‚Äî simple but has boundary bursts</span>
100 requests per 60-second window

<span class="comment"># Sliding Window ‚Äî smooth, no boundary problem</span>
Track per-second timestamps in Redis sorted set
ZREMRANGEBYSCORE: remove old entries
ZCARD: count current window

<span class="comment"># Token Bucket ‚Äî bursty traffic friendly</span>
bucket fills at rate R, max capacity C
each request consumes 1 token
allows burst up to C, then enforces rate R

<span class="comment"># Response headers</span>
X-RateLimit-Limit: 100
X-RateLimit-Remaining: 45
X-RateLimit-Reset: 1705312800
Retry-After: 30   <span class="comment"># when 429 returned</span></div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>CORS Deep Understanding</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>CORS is a browser security mechanism, not a server security mechanism. It does NOT protect your API from non-browser clients. Treat it as a convenience control, not a security boundary.</p>
              <div class="code-block"><span class="comment"># Preflight (OPTIONS) for complex requests</span>
OPTIONS /api/data
Origin: https://app.example.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Authorization

<span class="comment"># Server response</span>
Access-Control-Allow-Origin: https://app.example.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Authorization, Content-Type
Access-Control-Max-Age: 86400
<span class="comment"># Max-Age caches the preflight for 24h</span>

<span class="comment"># ‚ùå Never use wildcard with credentials</span>
Access-Control-Allow-Origin: *             <span class="comment"># ok for public APIs</span>
Access-Control-Allow-Credentials: true     <span class="comment"># ‚ùå cannot combine with *</span></div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>API Gateway Patterns</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>An API gateway is the single entry point for all clients. It offloads cross-cutting concerns from individual services.</p>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Gateway responsibilities: Authentication, Rate limiting, TLS termination, Request routing, Load balancing, Request/response transformation, Logging & monitoring.</span></div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Backend services should trust the gateway and use mTLS or internal tokens for service-to-service auth. Never expose backend services directly.</span></div>
            </div>
          </div>
        </div>
      </div>
      <div style="margin-top:var(--sp-3)">
        <button class="btn btn-primary btn-full" onclick="markComplete(5)">Mark Module Complete ‚úì</button>
      </div>
    </div>

    <!-- MODULE 6: PRODUCTION -->
    <div class="learn-section" id="ls-6">
      <div class="content-block">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <h3>Production Engineering</h3>
          <span class="chip chip-green">Ops</span>
        </div>
        <p>You can't improve what you can't observe. Production APIs need structured logging, distributed tracing, and meaningful metrics to diagnose incidents and prove SLA compliance.</p>
      </div>
      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Structured Logging</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <p>Always log JSON. Never log strings. Structured logs are queryable ‚Äî string logs require regex and prayer.</p>
              <div class="code-block">{
  <span class="string">"timestamp"</span>: <span class="string">"2024-01-15T10:30:00.123Z"</span>,
  <span class="string">"level"</span>: <span class="string">"info"</span>,
  <span class="string">"service"</span>: <span class="string">"user-api"</span>,
  <span class="string">"trace_id"</span>: <span class="string">"abc-123-xyz"</span>,
  <span class="string">"span_id"</span>: <span class="string">"def-456"</span>,
  <span class="string">"request_id"</span>: <span class="string">"req_01HABCDEF"</span>,
  <span class="string">"method"</span>: <span class="string">"POST"</span>,
  <span class="string">"path"</span>: <span class="string">"/api/v1/users"</span>,
  <span class="string">"status"</span>: <span class="number">201</span>,
  <span class="string">"latency_ms"</span>: <span class="number">45</span>,
  <span class="string">"user_id"</span>: <span class="string">"usr_789"</span>,
  <span class="string">"ip"</span>: <span class="string">"203.0.113.42"</span>
}

<span class="comment"># What NOT to log:</span>
<span class="comment"># - Passwords, tokens, secrets (ever)</span>
<span class="comment"># - PII without explicit consent + encryption</span>
<span class="comment"># - Full request/response bodies in prod</span></div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>OpenAPI & Documentation</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="code-block">openapi: <span class="string">"3.1.0"</span>
info:
  title: Example API
  version: <span class="string">"1.0.0"</span>

paths:
  /users/{id}:
    get:
      summary: Get user by ID
      operationId: getUser
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: <span class="keyword">true</span>
          schema: { type: string }
      responses:
        <span class="string">"200"</span>:
          content:
            application/json:
              schema: { $ref: <span class="string">"#/components/schemas/User"</span> }</div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Generate SDK clients from OpenAPI specs. Never write client SDKs by hand ‚Äî generate them. Keep spec as the source of truth.</span></div>
            </div>
          </div>
        </div>
      </div>
      <div style="margin-top:var(--sp-3)">
        <button class="btn btn-primary btn-full" onclick="markComplete(6)">Mark Module Complete ‚úì</button>
      </div>
    </div>

    <!-- MODULE 7: SYSTEM DESIGN -->
    <div class="learn-section" id="ls-7">
      <div class="content-block">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <h3>Real-World System Design</h3>
          <span class="chip chip-green">Architecture</span>
        </div>
        <p>Production systems at scale require careful architectural decisions. The patterns you choose today determine your operational complexity for years.</p>
      </div>
      <div class="accordion">
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Microservices API Patterns</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>API Composition: Gateway aggregates multiple service calls into one response. Reduces client round-trips but increases gateway coupling.</span></div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Saga Pattern: Distributed transactions via compensating actions. Each step publishes an event; rollback triggers compensating events.</span></div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>BFF (Backend for Frontend): Separate API layer per client type (mobile, web, TV). Each BFF is optimized for its consumer's data needs.</span></div>
              <div class="key-point"><span class="key-point-icon">‚ñ∏</span><span>Circuit Breaker: After N failures, open the circuit (fail fast) for T seconds. Prevents cascading failures in microservice meshes.</span></div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>Distributed Authentication</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="code-block"><span class="comment"># Service-to-service auth patterns</span>

<span class="comment"># Pattern 1: mTLS (mutual TLS)</span>
<span class="comment"># Both sides present certificates</span>
<span class="comment"># Infrastructure-level auth, no token management</span>

<span class="comment"># Pattern 2: JWT with internal signing key</span>
<span class="comment"># Gateway validates external JWT</span>
<span class="comment"># Issues internal JWT with service claims</span>
<span class="comment"># Internal services trust internal JWT only</span>

<span class="comment"># Pattern 3: Service accounts + SPIFFE/SPIRE</span>
<span class="comment"># SVIDs (SPIFFE Verifiable Identity Documents)</span>
<span class="comment"># Cryptographic service identity, auto-rotated</span></div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-header" onclick="toggleAccordion(this)">
            <span>API Versioning at Scale</span>
            <span class="accordion-icon">‚ñæ</span>
          </button>
          <div class="accordion-body">
            <div class="accordion-content">
              <div class="code-block"><span class="comment"># URL versioning ‚Äî most visible, easiest to route</span>
/api/v1/users
/api/v2/users

<span class="comment"># Header versioning ‚Äî cleaner URLs</span>
Accept: application/vnd.api+json; version=2

<span class="comment"># Date-based versioning (Stripe model)</span>
Stripe-Version: 2024-01-15

<span class="comment"># Breaking change policy:</span>
<span class="comment"># - Adding fields: non-breaking</span>
<span class="comment"># - Removing fields: breaking (major version)</span>
<span class="comment"># - Renaming fields: breaking</span>
<span class="comment"># - Changing field types: breaking</span>
<span class="comment"># - Adding required params: breaking</span></div>
            </div>
          </div>
        </div>
      </div>
      <div style="margin-top:var(--sp-3)">
        <button class="btn btn-primary btn-full" onclick="markComplete(7)">Mark Module Complete ‚úì</button>
      </div>
    </div>
  </div>

  <!-- ==================== PRACTICE ==================== -->
  <div class="screen" id="screen-practice">
    <div class="section-header">
      <h2 class="section-title">Practice</h2>
    </div>

    <div class="practice-tabs">
      <button class="p-tab active" onclick="switchPracticeTab('rest')">REST Builder</button>
      <button class="p-tab" onclick="switchPracticeTab('gql')">GraphQL</button>
      <button class="p-tab" onclick="switchPracticeTab('oauth')">OAuth Flow</button>
      <button class="p-tab" onclick="switchPracticeTab('quiz')">Quiz</button>
    </div>

    <!-- REST Builder -->
    <div class="practice-panel active" id="pp-rest">
      <div class="card">
        <div style="font-size:var(--text-sm);font-weight:700;color:var(--text-primary);margin-bottom:var(--sp-2)">REST Request Builder</div>
        <div class="rest-builder">
          <div class="url-row">
            <div class="select-wrap">
              <select class="input" id="rb-method">
                <option>GET</option>
                <option>POST</option>
                <option>PUT</option>
                <option>PATCH</option>
                <option>DELETE</option>
              </select>
            </div>
            <input class="input" id="rb-url" type="text" placeholder="/api/v1/users" value="/api/v1/users" aria-label="URL">
          </div>
          <div class="input-wrap">
            <label class="input-label" for="rb-headers">Headers (JSON)</label>
            <textarea class="input" id="rb-headers" rows="3" style="font-family:var(--font-mono);font-size:var(--text-xs);resize:vertical" aria-label="Headers">{"Authorization": "Bearer eyJhbGc...", "Content-Type": "application/json"}</textarea>
          </div>
          <div class="input-wrap" id="rb-body-wrap">
            <label class="input-label" for="rb-body">Request Body</label>
            <textarea class="input" id="rb-body" rows="4" style="font-family:var(--font-mono);font-size:var(--text-xs);resize:vertical" aria-label="Body">{"name": "Alice", "email": "alice@example.com"}</textarea>
          </div>
          <button class="btn btn-primary btn-full" onclick="simulateRest()">Send Request</button>
          <div>
            <div style="font-size:var(--text-xs);color:var(--text-muted);margin-bottom:8px;font-weight:600;">RESPONSE</div>
            <div class="req-output" id="rb-output" aria-live="polite">Click "Send Request" to simulate...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- GraphQL Builder -->
    <div class="practice-panel" id="pp-gql">
      <div class="card">
        <div style="font-size:var(--text-sm);font-weight:700;color:var(--text-primary);margin-bottom:var(--sp-2)">GraphQL Query Builder</div>
        <div class="gql-builder">
          <div class="input-wrap">
            <label class="input-label" for="gql-op">Operation Type</label>
            <div class="select-wrap">
              <select class="input" id="gql-op" onchange="updateGqlTemplate()">
                <option>query</option>
                <option>mutation</option>
                <option>subscription</option>
              </select>
            </div>
          </div>
          <div class="input-wrap">
            <label class="input-label" for="gql-query">Query Editor</label>
            <textarea class="gql-editor" id="gql-query" aria-label="GraphQL query">query GetUser($id: ID!) {
  user(id: $id) {
    id
    email
    posts(limit: 5) {
      id
      title
      createdAt
    }
  }
}</textarea>
          </div>
          <div class="input-wrap">
            <label class="input-label" for="gql-vars">Variables (JSON)</label>
            <textarea class="input" id="gql-vars" rows="2" style="font-family:var(--font-mono);font-size:var(--text-xs)" aria-label="Variables">{"id": "user_123"}</textarea>
          </div>
          <button class="btn btn-primary btn-full" onclick="executeGql()">Execute Query</button>
          <div>
            <div style="font-size:var(--text-xs);color:var(--text-muted);margin-bottom:8px;font-weight:600;">RESPONSE</div>
            <div class="req-output" id="gql-output" aria-live="polite">Execute to see mock response...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- OAuth Flow -->
    <div class="practice-panel" id="pp-oauth">
      <div class="card">
        <div style="font-size:var(--text-sm);font-weight:700;color:var(--text-primary);margin-bottom:8px">OAuth 2.0 + PKCE Visualizer</div>
        <div style="font-size:var(--text-xs);color:var(--text-muted);margin-bottom:var(--sp-2)">Authorization Code Flow with PKCE</div>

        <div class="input-wrap" style="margin-bottom:var(--sp-2)">
          <label class="input-label">Flow Type</label>
          <div class="select-wrap">
            <select class="input" id="oauth-flow-type" onchange="resetOAuthFlow()">
              <option value="pkce">Auth Code + PKCE (Public Client)</option>
              <option value="cc">Client Credentials (M2M)</option>
            </select>
          </div>
        </div>

        <div class="oauth-flow" id="oauthFlow"></div>

        <div style="display:flex;gap:8px;margin-top:var(--sp-2)">
          <button class="btn btn-ghost" style="flex:1" onclick="resetOAuthFlow()">Reset</button>
          <button class="btn btn-primary" style="flex:2" onclick="nextOAuthStep()" id="oauthNextBtn">Next Step ‚Üí</button>
        </div>

        <div id="oauthDetails" style="margin-top:var(--sp-2);display:none">
          <div class="code-block" id="oauthDetailsCode" style="font-size:0.7rem"></div>
        </div>
      </div>
    </div>

    <!-- Quiz -->
    <div class="practice-panel" id="pp-quiz">
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:var(--sp-2)">
          <div style="font-size:var(--text-sm);font-weight:700;color:var(--text-primary)">API Knowledge Quiz</div>
          <span class="chip chip-green" id="quizScore">Score: 0/0</span>
        </div>
        <div class="quiz-container" id="quizContainer">
          <!-- Rendered by JS -->
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== LOGS ==================== -->
  <div class="screen" id="screen-logs">
    <div class="section-header">
      <h2 class="section-title">API Logs</h2>
      <button class="btn btn-ghost btn-sm" onclick="generateLogs()">‚Üª Refresh</button>
    </div>

    <div class="log-filters">
      <button class="log-filter active" onclick="filterLogs('all',this)">All</button>
      <button class="log-filter" onclick="filterLogs('2xx',this)">2xx</button>
      <button class="log-filter" onclick="filterLogs('4xx',this)">4xx</button>
      <button class="log-filter" onclick="filterLogs('5xx',this)">5xx</button>
      <button class="log-filter" onclick="filterLogs('slow',this)">Slow (&gt;200ms)</button>
    </div>

    <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:14px;overflow:hidden">
      <div class="log-header">
        <div>REQ ID</div>
        <div>METHOD</div>
        <div>STATUS</div>
        <div>LATENCY</div>
        <div>ENDPOINT</div>
      </div>
      <div id="logList"></div>
    </div>

    <div style="margin-top:var(--sp-2);font-size:var(--text-xs);color:var(--text-muted);text-align:center">
      Tap a log entry to view details
    </div>
  </div>

  <!-- ==================== PROFILE ==================== -->
  <div class="screen" id="screen-profile">
    <div class="profile-header">
      <div class="avatar">üë®‚Äçüíª</div>
      <div>
        <div class="profile-name">API Engineer</div>
        <div class="profile-level">‚ö° Level: Intermediate</div>
        <div style="margin-top:6px">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px">
            <span style="font-size:var(--text-xs);color:var(--text-muted)">Overall Progress</span>
            <span style="font-size:var(--text-xs);color:var(--neon);font-weight:700" id="profile-pct">0%</span>
          </div>
          <div class="progress-bar" style="width:180px">
            <div class="progress-fill" id="profile-bar" style="width:0%"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="section-header">
      <h2 class="section-title">Achievements</h2>
    </div>

    <div class="achievement-grid">
      <div class="achievement" id="ach-0">
        <div class="achievement-icon">üåê</div>
        <div class="achievement-name">HTTP Hero</div>
      </div>
      <div class="achievement" id="ach-1">
        <div class="achievement-icon">üîó</div>
        <div class="achievement-name">REST Master</div>
      </div>
      <div class="achievement" id="ach-2">
        <div class="achievement-icon">‚ö°</div>
        <div class="achievement-name">GraphQL Pro</div>
      </div>
      <div class="achievement" id="ach-3">
        <div class="achievement-icon">üîî</div>
        <div class="achievement-name">Webhook Wiz</div>
      </div>
      <div class="achievement" id="ach-4">
        <div class="achievement-icon">üîê</div>
        <div class="achievement-name">Auth Expert</div>
      </div>
      <div class="achievement" id="ach-5">
        <div class="achievement-icon">üõ°Ô∏è</div>
        <div class="achievement-name">Sec Guardian</div>
      </div>
      <div class="achievement" id="ach-6">
        <div class="achievement-icon">üìä</div>
        <div class="achievement-name">Prod Ready</div>
      </div>
      <div class="achievement" id="ach-7">
        <div class="achievement-icon">üèóÔ∏è</div>
        <div class="achievement-name">Architect</div>
      </div>
      <div class="achievement" id="ach-all">
        <div class="achievement-icon">üèÜ</div>
        <div class="achievement-name">API Master</div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="section-header">
      <h2 class="section-title">Settings</h2>
    </div>

    <div class="settings-list card">
      <div class="settings-item" onclick="resetProgress()">
        <span class="settings-item-label">Reset Progress</span>
        <span class="settings-arrow">‚Ä∫</span>
      </div>
      <div class="settings-item">
        <span class="settings-item-label">Version</span>
        <span class="settings-item-value">1.0.0</span>
      </div>
      <div class="settings-item">
        <span class="settings-item-label">Curriculum</span>
        <span class="settings-item-value">8 Modules ¬∑ 48 Lessons</span>
      </div>
    </div>
  </div>

  <!-- ==================== BOTTOM NAV ==================== -->
  <nav class="nav-bar" role="navigation" aria-label="Main navigation">
    <button class="nav-item active" onclick="navigate('home')" aria-label="Home" id="nav-home">
      <span class="nav-icon-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
      </span>
      <span class="nav-label">Home</span>
    </button>
    <button class="nav-item" onclick="navigate('learn')" aria-label="Learn" id="nav-learn">
      <span class="nav-icon-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
        </svg>
      </span>
      <span class="nav-label">Learn</span>
    </button>
    <button class="nav-item" onclick="navigate('practice')" aria-label="Practice" id="nav-practice">
      <span class="nav-icon-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <polygon points="5 3 19 12 5 21 5 3"/>
        </svg>
      </span>
      <span class="nav-label">Practice</span>
    </button>
    <button class="nav-item" onclick="navigate('logs')" aria-label="Logs" id="nav-logs">
      <span class="nav-icon-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <line x1="8" y1="6" x2="21" y2="6"/>
          <line x1="8" y1="12" x2="21" y2="12"/>
          <line x1="8" y1="18" x2="21" y2="18"/>
          <line x1="3" y1="6" x2="3.01" y2="6"/>
          <line x1="3" y1="12" x2="3.01" y2="12"/>
          <line x1="3" y1="18" x2="3.01" y2="18"/>
        </svg>
      </span>
      <span class="nav-label">Logs</span>
    </button>
    <button class="nav-item" onclick="navigate('profile')" aria-label="Profile" id="nav-profile">
      <span class="nav-icon-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
      </span>
      <span class="nav-label">Profile</span>
    </button>
  </nav>
</div>

<script>
// ============================================================
// STATE
// ============================================================
const STATE = {
  progress: JSON.parse(localStorage.getItem('api_progress') || '{}'),
  quizIdx: 0,
  quizScore: 0,
  quizAnswered: false,
  oauthStep: -1,
  logs: [],
  logFilter: 'all'
};

// ============================================================
// NAVIGATION
// ============================================================
function navigate(screen, tabIdx) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('screen-' + screen).classList.add('active');
  document.getElementById('nav-' + screen).classList.add('active');

  if (screen === 'learn' && tabIdx !== undefined) switchLearnTab(tabIdx);
  if (screen === 'logs' && !STATE.logs.length) generateLogs();
  if (screen === 'practice') initQuiz();
  if (screen === 'profile') updateProfileUI();
}

// ============================================================
// LEARN TABS
// ============================================================
function switchLearnTab(idx) {
  document.querySelectorAll('#learnTabs .tab').forEach((t, i) => {
    t.classList.toggle('active', i === idx);
  });
  document.querySelectorAll('.learn-section').forEach((s, i) => {
    s.classList.toggle('active', i === idx);
  });
}

// ============================================================
// ACCORDION
// ============================================================
function toggleAccordion(header) {
  const body = header.nextElementSibling;
  const isOpen = header.classList.contains('open');
  // Close all in same accordion
  header.closest('.accordion').querySelectorAll('.accordion-header').forEach(h => {
    h.classList.remove('open');
    h.nextElementSibling.classList.remove('open');
  });
  if (!isOpen) {
    header.classList.add('open');
    body.classList.add('open');
  }
}

// ============================================================
// PROGRESS TRACKING
// ============================================================
function markComplete(moduleIdx) {
  STATE.progress[moduleIdx] = 100;
  saveProgress();
  updateAllProgress();
  showToast(`‚úì Module ${moduleIdx + 1} complete!`);
  if (document.getElementById('ach-' + moduleIdx)) {
    document.getElementById('ach-' + moduleIdx).classList.add('earned');
  }
  if (Object.keys(STATE.progress).length >= 8) {
    document.getElementById('ach-all')?.classList.add('earned');
  }
}

function saveProgress() {
  localStorage.setItem('api_progress', JSON.stringify(STATE.progress));
}

function updateAllProgress() {
  for (let i = 0; i < 8; i++) {
    const pct = STATE.progress[i] || 0;
    const el = document.getElementById('mp-' + i);
    const bar = document.getElementById('mb-' + i);
    if (el) el.textContent = pct + '%';
    if (bar) bar.style.width = pct + '%';
  }
  const total = Object.values(STATE.progress).reduce((a, b) => a + b, 0);
  const overall = Math.round(total / 8);
  document.getElementById('stat-score').textContent = overall + '%';
}

function updateProfileUI() {
  const total = Object.values(STATE.progress).reduce((a, b) => a + b, 0);
  const pct = Math.round(total / 8);
  document.getElementById('profile-pct').textContent = pct + '%';
  document.getElementById('profile-bar').style.width = pct + '%';
  for (let i = 0; i < 8; i++) {
    const ach = document.getElementById('ach-' + i);
    if (ach && STATE.progress[i] >= 100) ach.classList.add('earned');
  }
  if (Object.keys(STATE.progress).filter(k => STATE.progress[k] >= 100).length >= 8) {
    document.getElementById('ach-all')?.classList.add('earned');
  }
}

function resetProgress() {
  if (confirm('Reset all progress?')) {
    STATE.progress = {};
    saveProgress();
    updateAllProgress();
    document.querySelectorAll('.achievement').forEach(a => a.classList.remove('earned'));
    showToast('Progress reset');
  }
}

// ============================================================
// REST BUILDER
// ============================================================
function simulateRest() {
  const method = document.getElementById('rb-method').value;
  const url = document.getElementById('rb-url').value || '/api/v1/users';
  const headers = document.getElementById('rb-headers').value;
  const body = document.getElementById('rb-body').value;

  const responses = {
    GET: { status: 200, data: { data: [{id:'usr_1',email:'alice@example.com',created_at:'2024-01-15T10:30:00Z'},{id:'usr_2',email:'bob@example.com',created_at:'2024-01-14T08:00:00Z'}], pagination:{next_cursor:'cur_abc',has_more:true,total:247} } },
    POST: { status: 201, data: { id:'usr_3', email:'new@example.com', created_at: new Date().toISOString() } },
    PUT: { status: 200, data: { id:'usr_1', email:'updated@example.com', updated_at: new Date().toISOString() } },
    PATCH: { status: 200, data: { id:'usr_1', email:'patched@example.com', updated_at: new Date().toISOString() } },
    DELETE: { status: 204, data: null }
  };

  const res = responses[method] || responses.GET;
  const latency = Math.floor(Math.random() * 120) + 15;

  const out = document.getElementById('rb-output');
  out.textContent = `HTTP/1.1 ${res.status} ${getStatusText(res.status)}
Content-Type: application/json
X-Request-ID: req_${Math.random().toString(36).slice(2,10)}
X-Response-Time: ${latency}ms

${res.data ? JSON.stringify(res.data, null, 2) : '(no body)'}`;
}

function getStatusText(code) {
  const map = {200:'OK',201:'Created',204:'No Content',400:'Bad Request',401:'Unauthorized',403:'Forbidden',404:'Not Found',429:'Too Many Requests',500:'Internal Server Error'};
  return map[code] || 'Unknown';
}

// ============================================================
// GRAPHQL
// ============================================================
function updateGqlTemplate() {
  const op = document.getElementById('gql-op').value;
  const templates = {
    query: `query GetUser($id: ID!) {\n  user(id: $id) {\n    id\n    email\n    posts(limit: 5) {\n      id\n      title\n    }\n  }\n}`,
    mutation: `mutation CreatePost($input: CreatePostInput!) {\n  createPost(input: $input) {\n    id\n    title\n    createdAt\n  }\n}`,
    subscription: `subscription OnPostCreated {\n  postCreated {\n    id\n    title\n    author {\n      id\n      email\n    }\n  }\n}`
  };
  document.getElementById('gql-query').value = templates[op];
}

function executeGql() {
  const op = document.getElementById('gql-op').value;
  const latency = Math.floor(Math.random() * 80) + 10;

  const mockResponses = {
    query: { data: { user: { id: 'user_123', email: 'alice@example.com', posts: [{ id: 'post_1', title: 'API Design Best Practices', createdAt: '2024-01-15T10:30:00Z' }, { id: 'post_2', title: 'GraphQL vs REST', createdAt: '2024-01-10T08:00:00Z' }] } } },
    mutation: { data: { createPost: { id: 'post_' + Math.floor(Math.random()*1000), title: 'New Post', createdAt: new Date().toISOString() } } },
    subscription: { data: null, errors: [{ message: 'Subscriptions require WebSocket transport', extensions: { code: 'SUBSCRIPTION_TRANSPORT_REQUIRED' } }] }
  };

  const res = mockResponses[op];
  document.getElementById('gql-output').textContent =
    `// Response time: ${latency}ms\n// Protocol: HTTP/2\n\n` + JSON.stringify(res, null, 2);
}

// ============================================================
// OAUTH FLOW VISUALIZER
// ============================================================
const OAUTH_STEPS = {
  pkce: [
    { title: 'Generate PKCE Challenge', desc: 'Client generates code_verifier + code_challenge (SHA256 hash)', code: `// Browser: generate PKCE
const verifier = crypto.randomUUID().replace(/-/g,'') + crypto.randomUUID().replace(/-/g,'');
const encoder = new TextEncoder();
const data = encoder.encode(verifier);
const hash = await crypto.subtle.digest('SHA-256', data);
const challenge = btoa(String.fromCharCode(...new Uint8Array(hash)))
  .replace(/\+/g,'-').replace(/\//g,'_').replace(/=/g,'');` },
    { title: 'Redirect to Authorization Server', desc: 'Browser navigates to /authorize with code_challenge', code: `// Redirect URL
https://auth.example.com/authorize?
  client_id=my-spa
  &redirect_uri=https://app.com/callback
  &response_type=code
  &scope=openid profile email
  &state=random-csrf-token
  &code_challenge=base64url_sha256_hash
  &code_challenge_method=S256` },
    { title: 'User Authenticates', desc: 'User enters credentials on the authorization server', code: `// Auth server authenticates user
// Shows consent screen for requested scopes
// User grants permission` },
    { title: 'Receive Authorization Code', desc: 'Auth server redirects back with auth code (expires in 60s)', code: `// Callback URL
https://app.com/callback?
  code=AUTH_CODE_abc123xyz
  &state=random-csrf-token  // verify this!

// ‚ö†Ô∏è Verify state matches what you sent` },
    { title: 'Exchange Code for Tokens', desc: 'Client exchanges code + verifier for access + refresh tokens', code: `POST https://auth.example.com/token
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code
&code=AUTH_CODE_abc123xyz
&redirect_uri=https://app.com/callback
&client_id=my-spa
&code_verifier=original_verifier_string` },
    { title: 'Receive Token Response', desc: 'Auth server validates verifier and returns tokens', code: `{
  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "refresh_token": "rt_01HABCDEF...",
  "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCI...",
  "scope": "openid profile email"
}` },
    { title: 'Call Protected API', desc: 'Use access token in Authorization header for API calls', code: `GET /api/v1/me
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI...
Accept: application/json

// When access token expires, use refresh token:
POST /token
grant_type=refresh_token
&refresh_token=rt_01HABCDEF...` }
  ],
  cc: [
    { title: 'Client Credentials Request', desc: 'Service authenticates with client_id + secret', code: `POST https://auth.example.com/token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials
&client_id=service-worker-abc
&client_secret=secret_xyz123
&scope=api:read api:write` },
    { title: 'Receive Access Token', desc: 'Auth server returns access token (no refresh token for CC flow)', code: `{
  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "scope": "api:read api:write"
}
// Note: No refresh_token ‚Äî just re-authenticate` },
    { title: 'Call Protected API', desc: 'Service calls API with Bearer token', code: `GET /api/v1/data
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI...
X-Service-Name: worker-service

// Token auto-renewed before expiry:
// Cache token, check expires_in, re-auth when needed` }
  ]
};

function resetOAuthFlow() {
  STATE.oauthStep = -1;
  document.getElementById('oauthDetails').style.display = 'none';
  renderOAuthFlow();
  document.getElementById('oauthNextBtn').textContent = 'Start Flow ‚Üí';
  document.getElementById('oauthNextBtn').disabled = false;
}

function renderOAuthFlow() {
  const type = document.getElementById('oauth-flow-type').value;
  const steps = OAUTH_STEPS[type];
  const container = document.getElementById('oauthFlow');
  container.innerHTML = '';

  steps.forEach((step, i) => {
    if (i > 0) {
      const conn = document.createElement('div');
      conn.className = 'flow-connector';
      if (i <= STATE.oauthStep) conn.style.background = 'var(--green-mid)';
      container.appendChild(conn);
    }

    const el = document.createElement('div');
    el.className = 'flow-step';
    if (i === STATE.oauthStep) el.classList.add('active-step');
    else if (i < STATE.oauthStep) el.classList.add('done-step');

    el.innerHTML = `
      <div class="step-num">${i < STATE.oauthStep ? '‚úì' : i + 1}</div>
      <div class="step-info">
        <div class="step-title">${step.title}</div>
        <div class="step-desc">${step.desc}</div>
      </div>`;
    container.appendChild(el);
  });
}

function nextOAuthStep() {
  const type = document.getElementById('oauth-flow-type').value;
  const steps = OAUTH_STEPS[type];
  STATE.oauthStep++;

  if (STATE.oauthStep >= steps.length) {
    STATE.oauthStep = steps.length;
    document.getElementById('oauthNextBtn').textContent = 'Completed! Reset?';
    document.getElementById('oauthNextBtn').onclick = resetOAuthFlow;
    document.getElementById('oauthDetails').style.display = 'none';
    renderOAuthFlow();
    return;
  }

  renderOAuthFlow();

  const step = steps[STATE.oauthStep];
  document.getElementById('oauthDetails').style.display = 'block';
  document.getElementById('oauthDetailsCode').textContent = step.code;

  const isLast = STATE.oauthStep >= steps.length - 1;
  document.getElementById('oauthNextBtn').textContent = isLast ? 'Complete Flow ‚úì' : `Next: ${steps[STATE.oauthStep + 1]?.title || ''} ‚Üí`;
}

// ============================================================
// QUIZ
// ============================================================
const QUIZ_QUESTIONS = [
  {
    q: 'Which HTTP method is idempotent but NOT safe?',
    opts: ['GET', 'POST', 'PUT', 'DELETE'],
    ans: 2,
    exp: 'PUT and DELETE are idempotent (same result if called multiple times) but not safe ‚Äî they modify server state. GET is both safe and idempotent. POST is neither.'
  },
  {
    q: 'What HTTP status code should a successful POST /users return?',
    opts: ['200 OK', '201 Created', '204 No Content', '202 Accepted'],
    ans: 1,
    exp: '201 Created is the correct response for a successful resource creation. It should also include a Location header pointing to the new resource URI.'
  },
  {
    q: 'In OAuth 2.0, what does PKCE protect against?',
    opts: ['SQL injection', 'Authorization code interception', 'CSRF attacks', 'JWT forgery'],
    ans: 1,
    exp: 'PKCE (Proof Key for Code Exchange) prevents authorization code interception attacks. If an attacker intercepts the auth code, they cannot exchange it without the code_verifier.'
  },
  {
    q: 'What is the N+1 problem in GraphQL?',
    opts: ['Too many schema fields', 'Fetching related data with N separate queries', 'Nested mutations failing', 'Variable type mismatches'],
    ans: 1,
    exp: 'The N+1 problem occurs when you fetch a list of N items then make a separate database query for each item\'s related data. Solution: use DataLoader to batch and deduplicate queries.'
  },
  {
    q: 'Which header is critical for webhook security verification?',
    opts: ['X-Webhook-ID', 'X-Webhook-Signature', 'Authorization', 'X-API-Key'],
    ans: 1,
    exp: 'X-Webhook-Signature contains an HMAC-SHA256 signature of the request body. Recipients must verify this signature before processing the event to prevent forgery.'
  },
  {
    q: 'What does an HTTP 429 response indicate?',
    opts: ['Bad request format', 'Resource not found', 'Too many requests (rate limited)', 'Server error'],
    ans: 2,
    exp: '429 Too Many Requests indicates the client has exceeded the rate limit. The response should include Retry-After and X-RateLimit-Reset headers.'
  },
  {
    q: 'What is the purpose of cursor-based pagination over offset pagination?',
    opts: ['It\'s faster for small datasets', 'It avoids data drift when items are added/removed', 'It supports complex filtering', 'It uses less bandwidth'],
    ans: 1,
    exp: 'Cursor pagination is stable ‚Äî adding or removing items between pages doesn\'t cause you to skip or duplicate records. Offset pagination suffers from drift when the dataset changes.'
  },
  {
    q: 'Which JWT algorithm should you prefer for production APIs?',
    opts: ['HS256', 'RS256', 'none', 'HS512'],
    ans: 1,
    exp: 'RS256 (asymmetric) is preferred because it uses separate signing/verification keys. Resource servers can verify tokens using the public key without access to the private signing key. Never use alg:none.'
  },
  {
    q: 'In GraphQL, what HTTP status does a successful query with partial errors return?',
    opts: ['200 OK', '207 Multi-Status', '400 Bad Request', '500 Internal Server Error'],
    ans: 0,
    exp: 'GraphQL always returns 200 OK for valid requests. Errors (including partial data errors) are included in the response body under the "errors" key alongside any available data.'
  },
  {
    q: 'What does using `crypto.timingSafeEqual()` for HMAC verification prevent?',
    opts: ['SQL injection', 'Timing side-channel attacks', 'Replay attacks', 'CSRF attacks'],
    ans: 1,
    exp: 'Timing side-channel attacks exploit the fact that string comparison short-circuits on the first mismatch. timingSafeEqual always takes the same time regardless of where strings differ, preventing attackers from deducing secrets bit-by-bit.'
  }
];

function initQuiz() {
  if (document.getElementById('quizContainer').children.length > 0) return;
  STATE.quizIdx = 0;
  STATE.quizScore = 0;
  renderQuiz();
}

function renderQuiz() {
  const q = QUIZ_QUESTIONS[STATE.quizIdx];
  const container = document.getElementById('quizContainer');
  const total = QUIZ_QUESTIONS.length;

  container.innerHTML = `
    <div class="quiz-q">${q.q}</div>
    <div class="quiz-options" id="quizOptions">
      ${q.opts.map((opt, i) => `
        <button class="quiz-option" onclick="answerQuiz(${i})" aria-label="Option ${String.fromCharCode(65+i)}: ${opt}">
          <span class="quiz-option-letter">${String.fromCharCode(65+i)}</span>
          <span>${opt}</span>
        </button>`).join('')}
    </div>
    <div class="quiz-feedback" id="quizFeedback"></div>
    <div class="quiz-nav">
      <span class="quiz-counter">${STATE.quizIdx + 1} / ${total}</span>
      <button class="btn btn-ghost btn-sm" id="quizNextBtn" onclick="nextQuestion()" style="display:none">
        ${STATE.quizIdx < total - 1 ? 'Next ‚Üí' : 'Finish'}
      </button>
    </div>`;
  updateQuizScore();
}

function answerQuiz(selectedIdx) {
  if (STATE.quizAnswered) return;
  STATE.quizAnswered = true;

  const q = QUIZ_QUESTIONS[STATE.quizIdx];
  const opts = document.querySelectorAll('.quiz-option');
  opts.forEach(o => o.style.pointerEvents = 'none');

  opts[selectedIdx].classList.add(selectedIdx === q.ans ? 'correct' : 'wrong');
  if (selectedIdx !== q.ans) opts[q.ans].classList.add('correct');

  if (selectedIdx === q.ans) STATE.quizScore++;

  const fb = document.getElementById('quizFeedback');
  fb.className = 'quiz-feedback show ' + (selectedIdx === q.ans ? 'good' : 'bad');
  fb.innerHTML = (selectedIdx === q.ans ? '‚úì Correct! ' : '‚úó Incorrect. ') + q.exp;

  document.getElementById('quizNextBtn').style.display = 'flex';
  updateQuizScore();
}

function nextQuestion() {
  STATE.quizAnswered = false;
  STATE.quizIdx++;
  if (STATE.quizIdx >= QUIZ_QUESTIONS.length) {
    showQuizResults();
  } else {
    renderQuiz();
  }
}

function showQuizResults() {
  const pct = Math.round((STATE.quizScore / QUIZ_QUESTIONS.length) * 100);
  const container = document.getElementById('quizContainer');
  container.innerHTML = `
    <div style="text-align:center;padding:var(--sp-3)">
      <div style="font-size:48px;margin-bottom:var(--sp-2)">${pct >= 80 ? 'üèÜ' : pct >= 60 ? 'üí™' : 'üìö'}</div>
      <div style="font-size:var(--text-2xl);font-weight:800;color:var(--neon)">${pct}%</div>
      <div style="font-size:var(--text-sm);color:var(--text-secondary);margin-top:8px">${STATE.quizScore}/${QUIZ_QUESTIONS.length} correct</div>
      <p style="font-size:var(--text-sm);color:var(--text-muted);margin-top:var(--sp-2)">
        ${pct >= 80 ? 'Excellent mastery! You understand API fundamentals at a production level.' : pct >= 60 ? 'Good progress! Review the modules covering your weak areas.' : 'Keep studying ‚Äî revisit the Learn section and try again.'}
      </p>
      <button class="btn btn-primary" style="margin-top:var(--sp-3)" onclick="retakeQuiz()">Retake Quiz</button>
    </div>`;
  document.getElementById('quizScore').textContent = `Score: ${pct}%`;
}

function retakeQuiz() {
  STATE.quizIdx = 0;
  STATE.quizScore = 0;
  STATE.quizAnswered = false;
  renderQuiz();
}

function updateQuizScore() {
  document.getElementById('quizScore').textContent = `Score: ${STATE.quizScore}/${QUIZ_QUESTIONS.length}`;
}

// ============================================================
// LOGS
// ============================================================
const LOG_ENDPOINTS = [
  '/api/v1/users', '/api/v1/posts', '/api/v1/auth/token',
  '/api/v1/webhooks', '/api/v1/products', '/api/v1/orders',
  '/api/v2/users/{id}', '/api/v1/search', '/api/v1/events',
  '/graphql', '/api/v1/analytics', '/api/v1/files'
];
const LOG_METHODS = ['GET','GET','GET','POST','POST','PUT','PATCH','DELETE'];
const LOG_STATUSES = [200,200,200,201,201,204,400,401,403,404,422,429,500,503];

function generateLogs() {
  STATE.logs = Array.from({ length: 40 }, (_, i) => {
    const method = LOG_METHODS[Math.floor(Math.random() * LOG_METHODS.length)];
    const status = LOG_STATUSES[Math.floor(Math.random() * LOG_STATUSES.length)];
    const latency = Math.floor(Math.random() * 450) + 8;
    const endpoint = LOG_ENDPOINTS[Math.floor(Math.random() * LOG_ENDPOINTS.length)];
    const now = new Date(Date.now() - i * 1200 - Math.random() * 5000);

    return {
      id: 'r' + Math.random().toString(36).slice(2,8),
      method,
      status,
      latency,
      endpoint,
      time: now.toTimeString().slice(0,8)
    };
  });
  renderLogs();
}

function filterLogs(filter, btn) {
  STATE.logFilter = filter;
  document.querySelectorAll('.log-filter').forEach(f => f.classList.remove('active'));
  btn.classList.add('active');
  renderLogs();
}

function renderLogs() {
  const filtered = STATE.logs.filter(log => {
    if (STATE.logFilter === 'all') return true;
    if (STATE.logFilter === '2xx') return log.status >= 200 && log.status < 300;
    if (STATE.logFilter === '4xx') return log.status >= 400 && log.status < 500;
    if (STATE.logFilter === '5xx') return log.status >= 500;
    if (STATE.logFilter === 'slow') return log.latency > 200;
    return true;
  });

  const list = document.getElementById('logList');
  list.innerHTML = filtered.slice(0, 25).map(log => {
    const sClass = log.status < 300 ? 'status-2xx' : log.status < 500 ? 'status-4xx' : 'status-5xx';
    const mClass = `method-${log.method.toLowerCase()}`;
    return `
      <div class="log-row" onclick="showLogDetail('${log.id}', '${log.method}', '${log.endpoint}', ${log.status}, ${log.latency}, '${log.time}')">
        <div class="log-cell log-id">${log.id}</div>
        <div class="log-cell"><span class="method-tag ${mClass}">${log.method}</span></div>
        <div class="log-cell"><span class="status-tag ${sClass}">${log.status}</span></div>
        <div class="log-cell log-latency">${log.latency}ms</div>
        <div class="log-cell log-endpoint">${log.endpoint}</div>
      </div>`;
  }).join('');
}

function showLogDetail(id, method, endpoint, status, latency, time) {
  const sText = getStatusText(status);
  showToast(`${method} ${endpoint} ‚Üí ${status} ${sText} ¬∑ ${latency}ms`);
}

// ============================================================
// TOAST
// ============================================================
let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3000);
}

// ============================================================
// PRACTICE TAB SWITCHING
// ============================================================
function switchPracticeTab(id) {
  document.querySelectorAll('.p-tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.practice-panel').forEach(p => p.classList.remove('active'));
  const idx = ['rest','gql','oauth','quiz'].indexOf(id);
  document.querySelectorAll('.p-tab')[idx].classList.add('active');
  document.getElementById('pp-' + id).classList.add('active');
  if (id === 'oauth') resetOAuthFlow();
}

// ============================================================
// PWA: Service Worker via Blob
// ============================================================
if ('serviceWorker' in navigator) {
  const sw = `
    const CACHE = 'api-mastery-v1';
    const ASSETS = ['/'];
    self.addEventListener('install', e => {
      e.waitUntil(caches.open(CACHE).then(c => c.addAll(ASSETS)));
      self.skipWaiting();
    });
    self.addEventListener('activate', e => {
      e.waitUntil(caches.keys().then(keys =>
        Promise.all(keys.filter(k => k !== CACHE).map(k => caches.delete(k)))
      ));
      self.clients.claim();
    });
    self.addEventListener('fetch', e => {
      e.respondWith(
        caches.match(e.request).then(r => r || fetch(e.request).catch(() =>
          caches.match('/') || new Response('Offline', { status: 503 })
        ))
      );
    });`;

  const blob = new Blob([sw], { type: 'application/javascript' });
  const url = URL.createObjectURL(blob);
  navigator.serviceWorker.register(url).catch(() => {});
}

// ============================================================
// PWA: Web App Manifest via meta injection
// ============================================================
const manifest = {
  name: 'API Mastery Guide',
  short_name: 'API Mastery',
  description: 'Professional API Development Mastery Curriculum',
  start_url: '/',
  display: 'standalone',
  background_color: '#0a1f12',
  theme_color: '#0d2818',
  orientation: 'portrait',
  icons: [{ src: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="22" fill="%230d2818"/><text y=".9em" font-size="70" x="14">‚ö°</text></svg>', sizes: 'any', type: 'image/svg+xml' }]
};
const mLink = document.createElement('link');
mLink.rel = 'manifest';
mLink.href = 'data:application/manifest+json,' + encodeURIComponent(JSON.stringify(manifest));
document.head.appendChild(mLink);

// ============================================================
// PWA: Install Prompt
// ============================================================
let deferredPrompt;
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('installBanner').classList.add('show');
});

document.getElementById('installBtn').addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    deferredPrompt = null;
    document.getElementById('installBanner').classList.remove('show');
  }
});

// ============================================================
// INIT
// ============================================================
updateAllProgress();
generateLogs();
initQuiz();
resetOAuthFlow();

// Restore achievements
for (let i = 0; i < 8; i++) {
  if (STATE.progress[i] >= 100) {
    document.getElementById('ach-' + i)?.classList.add('earned');
  }
}
</script>
</body>
</html>
